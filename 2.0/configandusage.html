<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia Site Renderer 1.4 at 2014-10-09 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>P6Spy - </title>
    <style type="text/css" media="all">
      @import url("../css/maven-base.css");
      @import url("../css/maven-theme.css");
      @import url("../css/site.css");
    </style>
    <link rel="stylesheet" href="../css/print.css" type="text/css" media="print" />
    <meta name="Date-Revision-yyyymmdd" content="20141009" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                    <div id="bannerLeft">
                P6Spy
                </div>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
                    
                  <div class="xright">        
                    
                 <span id="publishDate">Last Published: 2014-10-09</span>
              &nbsp;| <span id="projectVersion">Version: 2.1.2-SNAPSHOT</span>
            </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
                    
                                <h5>User's Guide</h5>
                  <ul>
                                                                                                                                                              <li class="collapsed">
                          <a href="../1.3/install.html" title="1.3">1.3</a>
                  </li>
                                                                                                                                                                                                            <li class="expanded">
                          <a href="../2.0/install.html" title="2.x">2.x</a>
                    <ul>
                      <li class="none">
                          <a href="../2.0/install.html" title="Installation">Installation</a>
            </li>
                      <li class="none">
                          <a href="../2.0/integration.html" title="Integration">Integration</a>
            </li>
                      <li class="none">
            <strong>Configuration and Usage</strong>
          </li>
                      <li class="none">
                          <a href="../2.0/releasenotes.html" title="Release Notes">Release Notes</a>
            </li>
                      <li class="none">
                          <a href="../2.0/knownissues.html" title="Known Issues">Known Issues</a>
            </li>
                      <li class="none">
                          <a href="../2.0/faq.html" title="FAQ">FAQ</a>
            </li>
                      <li class="none">
                          <a href="../2.0/troubleshooting.html" title="Troubleshooting">Troubleshooting</a>
            </li>
                      <li class="none">
                          <a href="../2.0/development.html" title="Development">Development</a>
            </li>
              </ul>
        </li>
          </ul>
                       <h5>Other</h5>
                  <ul>
                  <li class="none">
                          <a href="../thanks.html" title="Thanks">Thanks</a>
            </li>
                  <li class="none">
                          <a href="https://github.com/p6spy/p6spy/wiki/Download" class="externalLink" title="Download">Download</a>
            </li>
          </ul>
                       <h5>Project Documentation</h5>
                  <ul>
                                                                                                                                                                                                                    <li class="collapsed">
                          <a href="../project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                                                                                                                                                  <li class="collapsed">
                          <a href="../project-reports.html" title="Project Reports">Project Reports</a>
                  </li>
          </ul>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                   
                    
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <h1><a name="confusage">Configuration and Usage</a></h1>
<p>Configuration follows <b>layered approach</b>, where <b>each layer overrides the values set by the lower ones</b> (leaving those not provided unchanged):</p>

<ul>
  
<li>JMX set properties (please note, that these are reset on next reload)</li>
  
<li>System properties</li>
  
<li>Environment variables</li>
  
<li>spy.properties</li>
  
<li>defaults</li>
</ul>
<p>For the full list of available options, see the section <a href="#settings">Common Property File Settings</a>. Please note that providing any of these via System properties/Environment variables is possible, using the particular property name following naming rule: p6spy.config.&lt;property name&gt;=&lt;property value&gt;</p>
<p>Please be aware of the restriction. In fact this also means you need to be aware of values set by the lower configuration layers (including defaults) to properly override/modify those.</p>
<p>There are <b>two cases one needs to distinguish when overriding</b>:</p>

<ul>
  
<li>don&#x2019;t override the property on the current level (can be achieved by specifying neither key nor value) and</li>
  
<li>clear the property value (can be achieved by specifying the key empty string value, could be for specified in <tt>spy.properties</tt> like this: <tt>excludecategories=</tt>)</li>
</ul>
<p>The <tt>spy.properties</tt> configuration file can be located in various places. The following locations are searched to locate the file. </p>

<ol style="list-style-type: decimal">
  
<li>The file name configured in the system property &#x201c;spy.properties&#x201d; (can include path)</li>
  
<li>The current working directory (for relative path) or any directory (for absolute path)</li>
  
<li>The classpath</li>
</ol>
<div class="section">
<h2>Properties exposal via JMX<a name="Properties_exposal_via_JMX"></a></h2>
<p>Please note that all the properties are exposed via JMX. So you can use your tool of choice (e.g.,JConsole) to view/change them. Moreover reload operation is exposed as well. To provide on-demand reload option.</p>
<p>In the JConsole p6spy related JMX attributes might look like this:</p>
<p><img src="../images/jconsole.png" alt="JConsole" /></p></div>
<div class="section">
<h2>Command Line Options<a name="Command_Line_Options"></a></h2>
<p>Every parameter specified in the property file can be set and overriden at the command line using the Java -D flag (system property), adding the the prefix: </p>

<div class="source">
<pre>p6spy.config.
</pre></div>
<p>An example follows:</p>

<div class="source">
<pre>java -Dp6spy.config.logfile=my.log -Dp6spy.config.append=true
</pre></div>
<p>Moreover to set different file to be used as the properties file (as an example: another_spy.properties), it should be specified using system property &#x201c;spy.properties&#x201d; as:</p>

<div class="source">
<pre>java -Dspy.properties=c:\jboss\lib\another_spy.properties
</pre></div></div>
<div class="section">
<h2><a name="settings">Common Property File Settings</a><a name="Common_Property_File_Settings"></a></h2>
<p>An example <tt>spy.properties</tt> file follows (please note default values mentioned as these refer to defaults mentioned in section: <a href="#confusage">Configuration and Usage</a>):</p>

<div class="source">
<pre>#################################################################
# P6Spy Options File                                            #
# See documentation for detailed instructions                   #
# http://p6spy.github.io/p6spy/2.0/configandusage.html          #
#################################################################

#################################################################
# MODULES                                                       #
#                                                               #
# Module list adapts the modular functionality of P6Spy.       #
# Only modules listed are active.                       #
# (default is com.p6spy.engine.logging.P6LogFactory and         #
# com.p6spy.engine.spy.P6SpyFactory)                            #
# Please note that the core module (P6SpyFactory) can't be   # 
# deactivated.                                #
# Unlike the other properties, activation of the changes on     #
# this one requires reload.                         #
#################################################################
#modulelist=com.p6spy.engine.spy.P6SpyFactory,com.p6spy.engine.logging.P6LogFactory,com.p6spy.engine.outage.P6OutageFactory

################################################################
# CORE (P6SPY) PROPERTIES                                      #
################################################################

# A comma separated list of JDBC drivers to load and register.
# (default is empty)
#
# Note: This is normally only needed when using P6Spy in an
# application server environment with a JNDI data source or when
# using a JDBC driver that does not implement the JDBC 4.0 API
# (specifically automatic registration).
#driverlist=

# for flushing per statement
# (default is false)
#autoflush = false

# sets the date format using Java's SimpleDateFormat routine. 
# In case property is not set, miliseconds since 1.1.1970 (unix time) is used (default is empty)
#dateformat=

# prints a stack trace for every statement logged
#stacktrace=false
# if stacktrace=true, specifies the stack trace to print
#stacktraceclass=

# determines if property file should be reloaded
# Please note: reload means forgetting all the previously set
# settings (even those set during runtime - via JMX)
# and starting with the clean table 
# (default is false)
#reloadproperties=false

# determines how often should be reloaded in seconds
# (default is 60)
#reloadpropertiesinterval=60

# specifies the appender to use for logging
# Please note: reload means forgetting all the previously set
# settings (even those set during runtime - via JMX)
# and starting with the clean table 
# (only the properties read from the configuration file)
# (default is com.p6spy.engine.spy.appender.FileLogger)
#appender=com.p6spy.engine.spy.appender.Slf4JLogger
#appender=com.p6spy.engine.spy.appender.StdoutLogger
#appender=com.p6spy.engine.spy.appender.FileLogger

# name of logfile to use, note Windows users should make sure to use forward slashes in their pathname (e:/test/spy.log) 
# (used for com.p6spy.engine.spy.appender.FileLogger only)
# (default is spy.log)
#logfile = spy.log

# append to the p6spy log file. if this is set to false the
# log file is truncated every time. (file logger only)
# (default is true)
#append=true

# class to use for formatting log messages (default is: com.p6spy.engine.spy.appender.SingleLineFormat)
#logMessageFormat=com.p6spy.engine.spy.appender.SingleLineFormat

# format that is used for logging of the date/time/... (has to be compatible with java.text.SimpleDateFormat)
# (default is dd-MMM-yy)
#databaseDialectDateFormat=dd-MMM-yy

# whether to expose options via JMX or not
# (default is true)
#jmx=true

# if exposing options via jmx (see option: jmx), what should be the prefix used?
# jmx naming pattern constructed is: com.p6spy(.&lt;jmxPrefix&gt;)?:name=&lt;optionsClassName&gt;
# please note, if there is already such a name in use it would be unregistered first (the last registered wins)
# (default is none)
#jmxPrefix=

#################################################################
# DataSource replacement                                        #
#                                                               #
# Replace the real DataSource class in your application server  #
# configuration with the name com.p6spy.engine.spy.P6DataSource #
# (that provides also connection pooling and xa support).       #
# then add the JNDI name and class name of the real             #
# DataSource here                                               #
#                                                               #
# Values set in this item cannot be reloaded using the          #
# reloadproperties variable. Once it is loaded, it remains      #
# in memory until the application is restarted.                 #
#                                                               #
#################################################################
#realdatasource=/RealMySqlDS
#realdatasourceclass=com.mysql.jdbc.jdbc2.optional.MysqlDataSource

#################################################################
# DataSource properties                                         #
#                                                               #
# If you are using the DataSource support to intercept calls    #
# to a DataSource that requires properties for proper setup,    #
# define those properties here. Use name value pairs, separate  #
# the name and value with a semicolon, and separate the         #
# pairs with commas.                                            #
#                                                               #
# The example shown here is for mysql                           #
#                                                               #
#################################################################
#realdatasourceproperties=port;3306,serverName;myhost,databaseName;jbossdb,foo;bar

#################################################################
# JNDI DataSource lookup                                        #
#                                                               #
# If you are using the DataSource support outside of an app     #
# server, you will probably need to define the JNDI Context     #
# environment.                                                  #
#                                                               #
# If the P6Spy code will be executing inside an app server then #
# do not use these properties, and the DataSource lookup will   #
# use the naming context defined by the app server.             #
#                                                               #
# The two standard elements of the naming environment are       #
# jndicontextfactory and jndicontextproviderurl. If you need    #
# additional elements, use the jndicontextcustom property.      #
# You can define multiple properties in jndicontextcustom,      #
# in name value pairs. Separate the name and value with a       #
# semicolon, and separate the pairs with commas.                #
#                                                               #
# The example shown here is for a standalone program running on #
# a machine that is also running JBoss, so the JDNI context     #
# is configured for JBoss (3.0.4).                              #
#                                                               #
# (by default all these are empty)                              #
#################################################################
#jndicontextfactory=org.jnp.interfaces.NamingContextFactory
#jndicontextproviderurl=localhost:1099
#jndicontextcustom=java.naming.factory.url.pkgs;org.jboss.nameing:org.jnp.interfaces

#jndicontextfactory=com.ibm.websphere.naming.WsnInitialContextFactory
#jndicontextproviderurl=iiop://localhost:900

################################################################
# P6 LOGGING SPECIFIC PROPERTIES                               #
################################################################

# filter what is logged
# please note this is a precondition for usage of: include/exclude/sqlexpression
# (default is false)
#filter=false

# comma separated list of strings to include
# please note that special characters escaping (used in java) has to be done for the provided regular expression
# (default is empty)
#include =
# comma separated list of strings to exclude
# (default is empty)
#exclude =

# sql expression to evaluate if using regex
# please note that special characters escaping (used in java) has to be done for the provided regular expression
# (default is empty)
#sqlexpression = 

#list of categories to exclude: error, info, batch, debug, statement,
#commit, rollback and result are valid values
# (default is info,debug,result,resultset,batch)
#excludecategories=info,debug,result,resultset,batch

# Execution threshold applies to the standard logging of P6Spy.       
# While the standard logging logs out every statement          
# regardless of its execution time, this feature puts a time   
# condition on that logging. Only statements that have taken   
# longer than the time specified (in milliseconds) will be     
# logged. This way it is possible to see only statements that  
# have exceeded some high water mark.                          
# This time is reloadable.                                     
#
# executionThreshold=integer time (milliseconds)
# (default is 0)
#executionThreshold=

################################################################
# P6 OUTAGE SPECIFIC PROPERTIES                                #
################################################################
# Outage Detection
#
# This feature detects long-running statements that may be indicative of
# a database outage problem. If this feature is turned on, it will log any
# statement that surpasses the configurable time boundary during its execution.
# When this feature is enabled, no other statements are logged except the long
# running statements. The interval property is the boundary time set in seconds.
# For example, if this is set to 2, then any statement requiring at least 2
# seconds will be logged. Note that the same statement will continue to be logged
# for as long as it executes. So if the interval is set to 2, and the query takes
# 11 seconds, it will be logged 5 times (at the 2, 4, 6, 8, 10 second intervals).
#
# outagedetection=true|false
# outagedetectioninterval=integer time (seconds)
#
# (default is false)
#outagedetection=false
# (default is 60)
#outagedetectioninterval=30
</pre></div>
<div class="section">
<h3>modulelist<a name="modulelist"></a></h3>
<p>modulelist holds the list of p6spy modules activated. A module contains a group of functionality. If none are specified only core p6spy framework will be activated (no logging,&#x2026;). Still once reload of the properties happen, or these are set by JMX, modules would be dynamically loaded/unloaded.</p>
<p>The following modules come with the p6spy by default:</p>

<div class="source">
<pre>modulelist=com.p6spy.engine.logging.P6LogFactory,com.p6spy.engine.outage.P6OutageFactory
</pre></div>
<p>Where these are required:</p>

<ul>
  
<li>com.p6spy.engine.logging.P6LogFactory - for the logging functionality, see <a href="#p6log">P6Log</a>.</li>
  
<li>com.p6spy.engine.outage.P6OutageFactory - for outage functionality, see <a href="#p6outage">P6Outage</a>.</li>
</ul>
<p>Please note to implement custom module have a look at the implementation of the any of the existing ones.</p></div>
<div class="section">
<h3>driverlist<a name="driverlist"></a></h3>
<p>This is a comma separated list of JDBC driver classes to load and register with DriverManager. You should list the classname(s) of the JDBC driver(s) that you want to proxy with P6Spy if any of the following conditions are met.</p>

<ol style="list-style-type: decimal">
  
<li>The JDBC driver does not implement the JDBC 4.0 API</li>
  
<li>You are using a JNDI Data Source - Some application servers will prevent the automatic registration feature from working.</li>
</ol></div>
<div class="section">
<h3>autoflush<a name="autoflush"></a></h3>
<p>For standard development, set the autoflush value to true. When set to true, every time a statement is intercepted, it is immediately written to the log file. In some cases, however, instant feedback on every statement is not a requirement. In those cases, the system performs slightly faster with autoflush set to false.</p>
<p>An example follows:</p>

<div class="source">
<pre>autoflush = true
</pre></div></div>
<div class="section">
<h3>dateformat<a name="dateformat"></a></h3>
<p>Setting a value for dateformat changes the date format value printed in the log file. No value prints the current time in milliseconds (unix time), a useful feature for parsing the log. The date format engine is Java&#x2019;s SimpleDateFormat class. Refer to the SimpleDateFormat class in the JavaDocs for information on setting this value. An example follows:</p>

<div class="source">
<pre>dateformat=MM-dd-yy HH:mm:ss:SS
</pre></div></div>
<div class="section">
<h3>stacktrace<a name="stacktrace"></a></h3>
<p>If stacktrace is set, the log prints out the stack trace for each SQL statement logged.</p></div>
<div class="section">
<h3>stacktraceclass<a name="stacktraceclass"></a></h3>
<p>Limits the stack traces printed to those that contain the value set in stacktraceclass. For example, specifying stacktraceclass=com.mycompany.myclass limits the printing of stack traces to the specified class value. The stack trace is converted to a String and string.indexOf(stacktraceclass) is performed.</p></div>
<div class="section">
<h3>reloadproperties and reloadpropertiesinterval<a name="reloadproperties_and_reloadpropertiesinterval"></a></h3>
<p>If reloadproperties is set to true, the property file is reloaded every n seconds, where n is defined by the value set by reloadpropertiesinterval. For example, if reloadproperties=true and reloadpropertiesinterval=10, the system checks the File.lastModified() property of the property file every 10 seconds, and if the file has been modified, it will be reloaded.</p>
<p>If you set append=true, the log will be suddenly truncated when you change your properties. This is because using reloadproperties is intended to be the equivalent of restarting your application server. Restarting your application server truncates your log file.</p>
<p>reloadproperties will not reload any driver information (such as realdriver, realdriver2, and realdriver3) and will not change the modules that are in memory.</p></div>
<div class="section">
<h3>appender<a name="appender"></a></h3>
<p>Appenders allow you to specify where and how log information is output. Appenders are a flexible architecture allowing anyone to write their own output class for P6Spy. To use an appender, specify the classname of the appender to use. The current release comes with three options which are slf4j, stdout, and logging to a file (default). Please note, that all of these output in the CSV format (where separator is: &#x201c;|&#x201d;).</p>

<ul>
  
<li>
<p><b>Using the File output</b>: Uncomment the <tt>FileLogger</tt> appender and specify a <tt>logfile</tt> and  whether or not to <tt>append</tt> to the file or to clear the file each time:</p>
  
<div class="source">
<pre>#appender=com.p6spy.engine.spy.appender.Slf4JLogger
#appender=com.p6spy.engine.spy.appender.StdoutLogger
appender=com.p6spy.engine.spy.appender.FileLogger

# name of logfile to use, note Windows users should make sure to use forward slashes in their pathname (e:/test/spy.log) 
# (used for com.p6spy.engine.spy.appender.FileLogger only)
# (default is spy.log)
#logfile = spy.log

# append to the p6spy log file. if this is set to false the
# log file is truncated every time. (file logger only)
append=true
</pre></div></li>
  
<li>
<p><b>Using StdOut</b>: Uncomment the <tt>StdoutLogger</tt> as follows:</p>
  
<div class="source">
<pre>#appender=com.p6spy.engine.spy.appender.Slf4JLogger
appender=com.p6spy.engine.spy.appender.StdoutLogger
#appender=com.p6spy.engine.spy.appender.FileLogger
</pre></div></li>
  
<li>
<p><b>Using SLF4J</b>: Uncomment the <tt>Slf4JLogger</tt> as follows:</p>
  
<div class="source">
<pre>appender=com.p6spy.engine.spy.appender.Slf4JLogger
#appender=com.p6spy.engine.spy.appender.StdoutLogger
#appender=com.p6spy.engine.spy.appender.FileLogger
</pre></div>
<p>In general you need to slf4j-api and the appropriate bridge to the actual logging implementation as well as the logging implementation itself on your classpath. To simplify setup for those not having any of the additional dependencies already on classpath following <tt>*-nodep.jar</tt> bundles are provided as part of p6spy distribution:</p>
  
<ul>
    
<li><tt>p6spy-&lt;version&gt;-log4j-nodep.jar</tt> - having <a class="externalLink" href="http://logging.apache.org/log4j/1.2/">log4j</a> included,</li>
    
<li><tt>p6spy-&lt;version&gt;-log4j2-nodep.jar</tt> - having <a class="externalLink" href="http://logging.apache.org/log4j/2.x/">log4j2</a> included and</li>
    
<li><tt>p6spy-&lt;version&gt;-logback-nodep.jar</tt> - having <a class="externalLink" href="http://logback.qos.ch/">logback</a> included.</li>
  </ul>
<p>Mapping to SLF4J levels is provided in the following way:</p>
  
<table border="0" class="bodyTable">

<tr class="a">
<th>P6Spy category</th>
<th>SLF4J level</th></tr>

<tr class="b">
<td>error</td>
<td>error</td></tr>

<tr class="a">
<td>warn</td>
<td>warn</td></tr>

<tr class="b">
<td>debug</td>
<td>debug</td></tr>

<tr class="a">
<td>info/any other category</td>
<td>info</td></tr>
</table>
<p>Internally is Slf4j Logger is retrieved for the: <tt>p6spy</tt>, keep this in mind when configuring your logging implementation. So for example for the <tt>log4j</tt> following could be used to restrict the p6spy logging (if using xml-based configuration) to <tt>INFO</tt> level only:</p>
  
<div class="source">
<pre>  &lt;category name=&quot;p6spy&quot;&gt;
    &lt;priority value=&quot;INFO&quot; /&gt;
  &lt;/category&gt;
</pre></div>
<p>For further instructions on configuring SLF4J, see the <a class="externalLink" href="http://www.slf4j.org/manual.html">SLF4J documentation</a>.</p></li>
</ul></div>
<div class="section">
<h3>logMessageFormat<a name="logMessageFormat"></a></h3>
<p>The log message format is selected by specifying the class to use to format the log messages. The following classes are available with P6Spy.</p>

<ul>
  
<li>
<p><tt>com.p6spy.engine.spy.appender.SingleLineFormat</tt> which results in log messages in format:</p>
  
<div class="source">
<pre>current time|execution time|category|connection id|statement SQL String|effective SQL string
</pre></div></li>
  
<li>
<p><tt>com.p6spy.engine.spy.appender.MultiLineFormat</tt>, which results in log messages in format: </p>
  
<div class="source">
<pre>current time|execution time|category|connection id|statement SQL String
effective SQL string
</pre></div></li>
</ul>
<p>Where:</p>

<ul>
  
<li><tt>current time</tt> - the current time is obtained through System.getCurrentTimeMillis() and represents  the number of milliseconds that have passed since January 1, 1970 00:00:00.000 GMT.  (Refer to the J2SE documentation for further details on System.getCurrentTimeMillis().)  To change the format, use the dateformat property described in  <a href="#settings">Common Property File Settings</a>.</li>
  
<li><tt>execution time</tt> - the time it takes in milliseconds for a particular method to execute. (This is  not the total cost for the SQL statement.) For example, a statement  <tt>SELECT * FROM MYTABLE WHERE THISCOL = ?</tt> might be executed as a prepared  statement, in which the .execute() function will be measured. This is recorded as  the statement category. Further, as you call .next() on the ResultSet, each .next()  call is recorded in the result category.</li>
  
<li><tt>category</tt> - You can manage your log by including and excluding categories,  which is described in <a href="#settings">Common Property File Settings</a>.</li>
  
<li><tt>connection id</tt> - Indicates the connection on which the activity was logged. The connection id is a sequentially  generated identifier.</li>
  
<li><tt>statement SQL string</tt> - This is the SQL string passed to the statement object.  If it is a prepared statement, it is the prepared statement that existed prior to  the parameters being set. To see the complete statement, refer to effective SQL string.</li>
  
<li><tt>effective SQL string</tt> - If you are not using a prepared statement, this contains no  value. Otherwise, it fills in the values of the Prepared Statement so you can see  the effective SQL statement that is passed to the database. Of course, the database  still sees the prepared statement, but this string is a convenient way to see the  actual values being sent to the database.</li>
</ul>
<p>The <tt>com.p6spy.engine.spy.appender.MultiLineFormat</tt> might be better from a readability perspective. Because it will place the effective SQL statement on a separate line. However, the SingleLineFormat might be better if you have a need to parse the log messages. The default is <tt>com.p6spy.engine.spy.appender.SingleLineFormat</tt> for backward compatibility.</p>
<p>You can also supply your own log message formatter to customize the format. Simply create a class which implements the <tt>com.p6spy.engine.spy.appender.MessageFormattingStrategy</tt> interface and place it on the classpath.</p></div>
<div class="section">
<h3>filter, include, exclude<a name="filter_include_exclude"></a></h3>
<p>P6Spy allows you to filter SQL queries by specific strings to be present (<tt>includes</tt> property value) or not present (<tt>excludes</tt> property value). As a precondition, setting <tt>filter=true</tt> has to be provided. P6Spy will perform string matching on each statement to determine if it should be written to the log file. <tt>include</tt> accepts a comma-delimited list of expressions which is required to appear in a statement before it can appear in the log. <tt>exclude</tt> accepts a comma-delimited list to exclude. Exclusion overrides inclusion, so that a statement matching both an include string and an exclude string is excluded.</p>
<p>Please note that matching mode used in the underlying regex is (achieved via prefix <tt>(?mis)</tt>):</p>

<ul>
  
<li><a class="externalLink" href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html#MULTILINE">multiline</a>,</li>
  
<li><a class="externalLink" href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html#DOTALL">dotall</a> and</li>
  
<li><a class="externalLink" href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html#CASE_INSENSITIVE">case insensitive</a>.</li>
</ul>
<p>An example showing capture of all statements having select, except those having order follow:</p>

<div class="source">
<pre>filter = true
# comma separated list of strings to include
include = select
# comma separated list of strings to exclude
exclude = order
</pre></div>
<p>Please note, that internally following regex would be used for particular expression matching: <tt>(?mis)^(?!.*(order).*)(.*(select).*)$</tt></p>
<p>An example showing only capture statements having any of: order_details, price, and price_history follows:</p>

<div class="source">
<pre>filter = true
# comma separated list of strings to include
include = order,order_details,price,price_history
# comma separated list of strings to exclude
exclude =
</pre></div>
<p>Please note, that internally following regex would be used for particular expression matching: <tt>(?mis)^(.*(order|order_details|price|price_history).*)$</tt></p>
<p>An example showing the capture of all statements, except statements order string in them follows:</p>

<div class="source">
<pre>filter = false
# comma separated list of strings to include
include =
# comma separated list of strings to exclude
exclude = order
</pre></div>
<p>Please note, that internally following regex would be used for particular expression matching: <tt>(?mis)^(?!.*(order).*)(.*)$</tt></p>
<p>As you can use full regex syntax, capture of statements having: pri[cz]e follows:</p>

<div class="source">
<pre>filter = true
# comma separated list of strings to include
include = pri[cz]e
# comma separated list of strings to exclude
exclude =
</pre></div>
<p>Please note, that internally following regex would be used for particular expression matching: <tt>(?mis)^(.*(pri[cz]e).*)$</tt></p>
<p>Moreover, please note, that special characters escaping (used in java) has to be done for the provided regular expression. As an example, matching for:</p>

<div class="source">
<pre>from\scustomers
</pre></div>
<p>would mean, that following should be specified (please note doubled backslash):</p>

<div class="source">
<pre>filter=true
include=from\\scustomers
</pre></div></div>
<div class="section">
<h3>filter, sqlexpression<a name="filter_sqlexpression"></a></h3>
<p>If you need more control over regular expression for matching, SQL string property <tt>sqlexpression</tt> is to be used as an alternative to <tt>exclude</tt> and <tt>include</tt>. An example follows:</p>

<div class="source">
<pre>filter = true
sqlexpression = your expression
</pre></div>
<p>If your expression matches the SQL string, it is logged. If the expression does not match, it is not logged. Please note you can use <tt>sqlexpression</tt> together with <tt>include</tt>/<tt>exclude</tt>, where both would be evaluated.</p>
<p>Moreover, please note, that special characters escaping (used in java) has to be done for the provided regular expression. As an example, matching for:</p>

<div class="source">
<pre>^(.*(from\scustomers).*)$
</pre></div>
<p>would mean, that following should be specified (please note doubled backslash)::</p>

<div class="source">
<pre>filter=true
sqlexpression=^(.*(from\\scustomers).*)$
</pre></div></div>
<div class="section">
<h3>excludecategories<a name="excludecategories"></a></h3>
<p>The log includes category information that describes the type of statement. This property excludes the listed categories. Valid options include the following:</p>

<ul>
  
<li><tt>error</tt> includes P6Spy errors. (It is recommended that you include this category.)</li>
  
<li><tt>info</tt> includes driver startup information and property file information.</li>
  
<li><tt>debug</tt> is only intended for use when you cannot get your driver to work properly, because it writes everything.</li>
  
<li><tt>statement</tt> includes Statements, PreparedStatements, and CallableStatements.</li>
  
<li><tt>batch</tt> includes calls made to the addBatch() JDBC API.</li>
  
<li><tt>commit</tt> includes calls made to the commit() JDBC API.</li>
  
<li><tt>rollback</tt> includes calls made to the rollback() JDBC API.</li>
  
<li><tt>result</tt> includes statements generated by ResultSet.</li>
</ul>
<p>Enter a comma-delimited list of categories to exclude from your log file. See filter, include, exclude for more details on how this process works.</p></div>
<div class="section">
<h3>outagedetection<a name="outagedetection"></a></h3>
<p>This feature detects long-running statements that may be indicative of a database outage problem. When enabled, it logs any statement that surpasses the configurable time boundary during its execution. No other statements are logged except the long-running statements.</p></div>
<div class="section">
<h3>outagedetectioninterval<a name="outagedetectioninterval"></a></h3>
<p>The interval property is the boundary time set in seconds. For example, if set to 2, any statement requiring at least 2 seconds is logged. The same statement will continue to be logged for as long as it executes. So, if the interval is set to 2 and a query takes 11 seconds, it is logged 5 times (at the 2, 4, 6, 8, 10-second intervals).</p></div></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                    2002-2014
                      P6Spy.
            All Rights Reserved.      
                    
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
