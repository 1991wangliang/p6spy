<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia Site Renderer 1.4 at 2014-04-04 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>P6Spy - </title>
    <style type="text/css" media="all">
      @import url("../css/maven-base.css");
      @import url("../css/maven-theme.css");
      @import url("../css/site.css");
    </style>
    <link rel="stylesheet" href="../css/print.css" type="text/css" media="print" />
    <meta name="Date-Revision-yyyymmdd" content="20140404" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                    <div id="bannerLeft">
                P6Spy
                </div>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
                    
                  <div class="xright">        
                    
                 <span id="publishDate">Last Published: 2014-04-04</span>
              &nbsp;| <span id="projectVersion">Version: 2.0.3-SNAPSHOT</span>
            </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
                    
                                <h5>User's Guide</h5>
                  <ul>
                                                                                                                                                              <li class="collapsed">
                          <a href="../1.3/install.html" title="1.3">1.3</a>
                  </li>
                                                                                                                                                                                                            <li class="expanded">
                          <a href="../2.0/install.html" title="2.0">2.0</a>
                    <ul>
                      <li class="none">
                          <a href="../2.0/install.html" title="Installation">Installation</a>
            </li>
                      <li class="none">
                          <a href="../2.0/integration.html" title="Integration">Integration</a>
            </li>
                      <li class="none">
            <strong>Configuration and Usage</strong>
          </li>
                      <li class="none">
                          <a href="../2.0/releasenotes.html" title="Release Notes">Release Notes</a>
            </li>
                      <li class="none">
                          <a href="../2.0/knownissues.html" title="Known Issues">Known Issues</a>
            </li>
                      <li class="none">
                          <a href="../2.0/faq.html" title="FAQ">FAQ</a>
            </li>
                      <li class="none">
                          <a href="../2.0/troubleshooting.html" title="Troubleshooting">Troubleshooting</a>
            </li>
                      <li class="none">
                          <a href="../2.0/development.html" title="Development">Development</a>
            </li>
              </ul>
        </li>
          </ul>
                       <h5>Other</h5>
                  <ul>
                  <li class="none">
                          <a href="../thanks.html" title="Thanks">Thanks</a>
            </li>
                  <li class="none">
                          <a href="https://github.com/p6spy/p6spy/wiki/Download" class="externalLink" title="Download">Download</a>
            </li>
          </ul>
                       <h5>Project Documentation</h5>
                  <ul>
                                                                                                                                                                                                                    <li class="collapsed">
                          <a href="../project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                                                                                                                                                  <li class="collapsed">
                          <a href="../project-reports.html" title="Project Reports">Project Reports</a>
                  </li>
          </ul>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                   
                    
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <h1><a name="confusage">Configuration and Usage</a></h1>
<p>Configuration follows layered approach, where each layer overrides the values set by the lower ones (leaving those not provided unchanged):</p>

<ul>
  
<li>JMX set properties (please note, that these are reset on next reload)</li>
  
<li>System properties</li>
  
<li>Environment variables</li>
  
<li>spy.properties</li>
  
<li>defaults</li>
</ul>
<p>For the full list of available options, see the section <a href="#settings">Common Property File Settings</a>. Please note that providing any of these via System properties/Environment variables is possible, using the particular property name following naming rule: p6spy.config.&lt;property name&gt;=&lt;property value&gt;</p>
<p>To enable full overriding capabilities, all those options considering lists (comma separated) values follow the rules:</p>

<ul>
  
<li>&#x201c;-&#x201d;&lt;property value&gt; - causes removal of particular value from the list</li>
  
<li>&lt;property value&gt; - causes adding of particular value to the list</li>
</ul>
<p>Please be aware of the restriction. In fact this also means you need to be aware of values set by the lower configuration layers (including defaults) to properly override.modify those.</p>
<p>The <tt>spy.properties</tt> configuration file can be located in various places. The following locations are searched to locate the file. </p>

<ol style="list-style-type: decimal">
  
<li>The file name configured in the system property &#x201c;spy.properties&#x201d; (can include path)</li>
  
<li>The current working directory (for relative path) or any directory (for absolute path)</li>
  
<li>The classpath</li>
</ol>
<div class="section">
<h2>Properties exposal via JMX<a name="Properties_exposal_via_JMX"></a></h2>
<p>Please note that all the properties are exposed via JMX. So you can use your tool of choice (e.g.,JConsole) to view/change them. Moreover reload operation is exposed as well. To provide on-demand reload option.</p></div>
<div class="section">
<h2><a name="settings">Common Property File Settings</a><a name="Common_Property_File_Settings"></a></h2>
<p>An example spy.properties file follows (please note default values mentioned as these refer to defaults mentioned in section: <a href="#confusage">Configuration and Usage</a>):</p>

<div class="source">
<pre>#################################################################
# P6Spy Options File                                            #
# See documentation for detailed instructions                   #
#################################################################

#################################################################
# MODULES                                                       #
#                                                               #
# Modulelist addapts the modular functionality of P6Spy.       #
# Only modules listed are active.                       #
# (default is com.p6spy.engine.logging.P6LogFactory and         #
# com.p6spy.engine.spy.P6SpyFactory)                            #
# Please note that the core module (P6SpyFactory) can't be   # 
# deactivated                                  #
#################################################################
#modulelist=com.p6spy.engine.outage.P6OutageFactory,com.p6spy.engine.leak.P6LeakFactory

################################################################
# P6LOG SPECIFIC PROPERTIES                                    #
################################################################
# no properties currently available

################################################################
# P6LEAK SPECIFIC PROPERTIES                                   #
################################################################
# no properties currently available

################################################################
# EXECUTION THRESHOLD PROPERTIES                               #
################################################################
# This feature applies to the standard logging of P6Spy.       
# While the standard logging logs out every statement          
# regardless of its execution time, this feature puts a time   
# condition on that logging. Only statements that have taken   
# longer than the time specified (in milliseconds) will be     
# logged. This way it is possible to see only statements that  
# have exceeded some high water mark.                          
# This time is reloadable.                                     
#
# executionthreshold=integer time (milliseconds)
# (default is 0)
#executionthreshold=

################################################################
# P6OUTAGE SPECIFIC PROPERTIES                                 #
################################################################
# Outage Detection
#
# This feature detects long-running statements that may be indicative of
# a database outage problem. If this feature is turned on, it will log any
# statement that surpasses the configurable time boundary during its execution.
# When this feature is enabled, no other statements are logged except the long
# running statements. The interval property is the boundary time set in seconds.
# For example, if this is set to 2, then any statement requiring at least 2
# seconds will be logged. Note that the same statement will continue to be logged
# for as long as it executes. So if the interval is set to 2, and the query takes
# 11 seconds, it will be logged 5 times (at the 2, 4, 6, 8, 10 second intervals).
#
# outagedetection=true|false
# outagedetectioninterval=integer time (seconds)
#
# (default is false)
#outagedetection=false
# (default is 60)
#outagedetectioninterval=30

################################################################
# COMMON PROPERTIES                                            #
################################################################

# A comma separated list of JDBC drivers to load and register.
# (default is empty)
#
# Note: This is normally only needed when using P6Spy in an
# application server environment with a JNDI data source or when
# using a JDBC driver that does not implement the JDBC 4.0 API
# (specifically automatic registration).
#driverlist=

# comma separated list of tables to include
# (default is empty)
#include =
# comma separated list of tables to exclude
# (default is empty)
#exclude =

# sql expression to evaluate if using regex
# (default is empty)
#sqlexpression = 

# filter what is logged
# (default is false)
#filter=false

# for flushing per statement
# (default is false)
#autoflush = false

# sets the date format using Java's SimpleDateFormat routine. 
# In case property is not set, miliseconds since 1.1.1970 (unix time) is used (default is empty)
#dateformat=

#list of categories to exclude: error, info, batch, debug, statement,
#commit, rollback and result are valid values
# (default is info,debug,result,resultset,batch)
#excludecategories=info,debug,result,resultset,batch

#allows you to use a regex engine or your own matching engine to determine
#which statements to log
#
#stringmatcher=com.p6spy.engine.common.GnuRegexMatcher
#stringmatcher=com.p6spy.engine.common.JakartaRegexMatcher
stringmatcher=

# prints a stack trace for every statement logged
stacktrace=false
# if stacktrace=true, specifies the stack trace to print
stacktraceclass=

# determines if property file should be reloaded
# Please note: reload means forgetting all the previously set
# settings (even those set during runtime - via JMX)
# and starting with the clean table 
# (default is false)
#reloadproperties=false

# determines how often should be reloaded in seconds
# (default is 60)
#reloadpropertiesinterval=60

# specifies the appender to use for logging
# Please note: reload means forgetting all the previously set
# settings (even those set during runtime - via JMX)
# and starting with the clean table 
# (only the properties read from the configuration file)
# (default is com.p6spy.engine.spy.appender.FileLogger)
#appender=com.p6spy.engine.spy.appender.Slf4JLogger
#appender=com.p6spy.engine.spy.appender.StdoutLogger
#appender=com.p6spy.engine.spy.appender.FileLogger

# name of logfile to use, note Windows users should make sure to use forward slashes in their pathname (e:/test/spy.log) (used for file logger only)
# (default is spy.log)
#logfile = spy.log

# append to the p6spy log file. if this is set to false the
# log file is truncated every time. (file logger only)
# (default is true)
#append=true

# class to use for formatting log messages (default is: com.p6spy.engine.spy.appender.SingleLineFormat)
#logMessageFormat=com.p6spy.engine.spy.appender.SingleLineFormat

# format that is used for logging of the date/time/... (has to be compatible with java.text.SimpleDateFormat)
# (default is dd-MMM-yy)
#databaseDialectDateFormat=dd-MMM-yy

#################################################################
# DataSource replacement                                        #
#                                                               #
# Replace the real DataSource class in your application server  #
# configuration with the name com.p6spy.engine.spy.P6DataSource,#
# or com.p6spy.engine.spy.P6ConnectionPoolDataSource            #
# (that provides connection pooling and xa support).            #
# then add the JNDI name and class name of the real             #
# DataSource here                                               #
#                                                               #
# Values set in this item cannot be reloaded using the          #
# reloadproperties variable. Once it is loaded, it remains      #
# in memory until the application is restarted.                 #
#                                                               #
#################################################################
#realdatasource=/RealMySqlDS
#realdatasourceclass=com.mysql.jdbc.jdbc2.optional.MysqlDataSource

#################################################################
# DataSource properties                                         #
#                                                               #
# If you are using the DataSource support to intercept calls    #
# to a DataSource that requires properties for proper setup,    #
# define those properties here. Use name value pairs, separate  #
# the name and value with a semicolon, and separate the         #
# pairs with commas.                                            #
#                                                               #
# The example shown here is for mysql                           #
#                                                               #
#################################################################
#realdatasourceproperties=port;3306,serverName;myhost,databaseName;jbossdb,foo;bar

#################################################################
# JNDI DataSource lookup                                        #
#                                                               #
# If you are using the DataSource support outside of an app     #
# server, you will probably need to define the JNDI Context     #
# environment.                                                  #
#                                                               #
# If the P6Spy code will be executing inside an app server then #
# do not use these properties, and the DataSource lookup will   #
# use the naming context defined by the app server.             #
#                                                               #
# The two standard elements of the naming environment are       #
# jndicontextfactory and jndicontextproviderurl. If you need    #
# additional elements, use the jndicontextcustom property.      #
# You can define multiple properties in jndicontextcustom,      #
# in name value pairs. Separate the name and value with a       #
# semicolon, and separate the pairs with commas.                #
#                                                               #
# The example shown here is for a standalone program running on #
# a machine that is also running JBoss, so the JDNI context     #
# is configured for JBoss (3.0.4).                              #
#                                                               #
# (by default all these are empty)                              #
#################################################################
#jndicontextfactory=org.jnp.interfaces.NamingContextFactory
#jndicontextproviderurl=localhost:1099
#jndicontextcustom=java.naming.factory.url.pkgs;org.jboss.nameing:org.jnp.interfaces

#jndicontextfactory=com.ibm.websphere.naming.WsnInitialContextFactory
#jndicontextproviderurl=iiop://localhost:900
</pre></div>
<div class="section">
<h3>modulelist<a name="modulelist"></a></h3>
<p>modulelist holds the list of p6spy modules activated. A module contains a group of functionality. If none are specified only core p6spy framework will be activated (no logging,&#x2026;). Still once reload of the properties happen, or these are set by JMX, modules would be dynamically loaded/unloaded.</p>
<p>The following modules come with the p6spy by default:</p>

<div class="source">
<pre>modulelist=com.p6spy.engine.logging.P6LogFactory,com.p6spy.engine.outage.P6OutageFactory,com.p6spy.engine.leak.P6LeakFactory
</pre></div>
<p>Where these are required:  - com.p6spy.engine.logging.P6LogFactory - for the logging functionality, see <a href="#p6log">P6Log</a>.  - com.p6spy.engine.outage.P6OutageFactory - for outage functionality, see <a href="#p6outage">P6Outage</a>.  - com.p6spy.engine.leak.P6LeakFactory - for and leak functionality, see <a href="#p6leak">P6Leak</a>.</p>
<p>Please note to implement custom module have a look at the implementation of the any of the existing ones.</p></div>
<div class="section">
<h3>driverlist<a name="driverlist"></a></h3>
<p>This is a comma separated list of JDBC driver classes to load and register with DriverManager. You should list the classname(s) of the JDBC driver(s) that you want to proxy with P6Spy if any of the following conditions are met.</p>

<ol style="list-style-type: decimal">
  
<li>The JDBC driver does not implement the JDBC 4.0 API</li>
  
<li>You are using a JNDI Data Source - Some application servers will prevent the automatic registration feature from working.</li>
</ol></div>
<div class="section">
<h3>filter, include, exclude<a name="filter_include_exclude"></a></h3>
<p>P6Spy allows you to monitor specific tables or specific statement types. By setting filter=true, P6Spy will perform string matching on each statement to determine if it should be written to the log file. include accepts a comma-delimited list of expressions which is required to appear in a statement before it can appear in the log. exclude accepts a comma-delimited list to exclude. By default, string matching is performed using a basic substring match. However, RegExp matching can also be used (see stringmatcher (Custom Filtering) below). Exclusion overrides inclusion, so that a statement matching both an include string and an exclude string is excluded.</p>
<p>An example showing capture of all select statements, except the orders table follows:</p>

<div class="source">
<pre>filter = true
# comma separated list of tables to include
include = select
# comma separated list of tables to exclude
exclude = orders
</pre></div>
<p>An example showing only capture statements against order, order_details, price, and price_history follows:</p>

<div class="source">
<pre>filter = true
# comma separated list of tables to include
include = order,order_details,price,price_history
# comma separated list of tables to exclude
exclude =
</pre></div>
<p>An example showing the capture of all statements, except statements against the order table follows:</p>

<div class="source">
<pre>filter = false
# comma separated list of tables to include
include =
# comma separated list of tables to exclude
exclude = order
</pre></div></div>
<div class="section">
<h3>filter, sqlexpression<a name="filter_sqlexpression"></a></h3>
<p>If you plan on using a RegExp engine, a simple alternative to exclude and include is to use sqlexpression. An example follows:</p>

<div class="source">
<pre>filter = true
sqlexpression = your expression
</pre></div>
<p>If your expression matches the SQL string, it is logged. If the expression does not match, it is not logged. If you use sqlexpression, any values set in include and exclude are ignored.</p></div>
<div class="section">
<h3>stringmatcher (Custom Filtering)<a name="stringmatcher_Custom_Filtering"></a></h3>
<p>If you want to apply more intelligence to what is logged or not logged by P6Spy, you can specify a custom matching engine. P6Spy comes with support for several RegExp engines, though it is trivial to introduce another engine by implementing the stringmatcher interface. If a stringmatcher engine is specified, P6Spy will pass each statement to the class specified to determine if that statement should be logged.</p>

<ul>
  
<li>Using GNU RegExp&#x2014;P6Spy comes with support for a regular expression matcher based on the GNU RegExp library. In order to do this, download the GNU Java RexExp library and add it to your classpath so that P6Spy can find it. The following is an example of the implementation:  # Use GNU Regex Matching for Filtering  stringmatcher =com.p6spy.engine.common.GnuRegexMatcher</li>
</ul>

<ul>
  
<li>Using Jakarta RegExp&#x2014;P6Spy also includes support for the Apache Jakarta RegExp library. In order to do this, download the Apache Jarkarta RegExp library and add it to your classpath so that P6Spy can find it. The following is an example of the implementation:  # Use Apache Jakarta Regex Matching for Filtering  stringmatcher =com.p6spy.engine.common.JakartaRegexMatcher</li>
</ul></div>
<div class="section">
<h3>autoflush<a name="autoflush"></a></h3>
<p>For standard development, set the autoflush value to true. When set to true, every time a statement is intercepted, it is immediately written to the log file. In some cases, however, instant feedback on every statement is not a requirement. In those cases, the system performs slightly faster with autoflush set to false.</p>
<p>An example follows:</p>

<div class="source">
<pre>autoflush = true
</pre></div></div>
<div class="section">
<h3>appender<a name="appender"></a></h3>
<p>Appenders allow you to specify where and how log information is output. Appenders are a flexible architecture allowing anyone to write their own output class for P6Spy. To use an appender, specify the classname of the appender to use. The current release comes with three options which are slf4j, stdout, and logging to a CSV text file (default).</p>

<ul>
  
<li>
<p>Using a CSV File&#x2014;To output to a file, uncomment the FileLogger appender and specify a logfile and  whether or not to append to the file or to clear the file each time:</p>
  
<div class="source">
<pre>#appender=com.p6spy.engine.spy.appender.Slf4JLogger
#appender=com.p6spy.engine.spy.appender.StdoutLogger
appender=com.p6spy.engine.spy.appender.FileLogger

# name of logfile to use, note Windows users should make sure to use forward slashes in their pathname(e:/test/spy.log) (used for file logger only)
logfile = spy.log

# append to the p6spy log file. if this is set to false the
# log file is truncated every time. (file logger only)
append=true
</pre></div></li>
  
<li>
<p>Using StdOut&#x2014;Uncomment the StdoutLogger as follows and all output will be sent to stdout in a CSV format:</p>
  
<div class="source">
<pre>#appender=com.p6spy.engine.spy.appender.Slf4JLogger
appender=com.p6spy.engine.spy.appender.StdoutLogger
#appender=com.p6spy.engine.spy.appender.FileLogger
</pre></div></li>
  
<li>
<p>Using SLF4J - To output to SLF4J, you need to make slf4j-api and the appropriate bridge to the actual logging implementation on your classpath. All log messages will be written at the INFO level to the &#x2018;p6spy&#x2019; category. For further instructions on configuring SLF4J, see the <a class="externalLink" href="http://www.slf4j.org/manual.html">SLF4J documentation</a>.</p></li>
</ul></div>
<div class="section">
<h3>excludecategories<a name="excludecategories"></a></h3>
<p>The log includes category information that describes the type of statement. This property excludes the listed categories. Valid options include the following:</p>

<ul>
  
<li>error includes P6Spy errors. (It is recommended that you include this category.)</li>
  
<li>info includes driver startup information and property file information.</li>
  
<li>debug is only intended for use when you cannot get your driver to work properly, because it writes everything.</li>
  
<li>statement includes Statements, PreparedStatements, and CallableStatements.</li>
  
<li>batch includes calls made to the addBatch() JDBC API.</li>
  
<li>commit includes calls made to the commit() JDBC API.</li>
  
<li>rollback includes calls made to the rollback() JDBC API.</li>
  
<li>result includes statements generated by ResultSet.</li>
</ul>
<p>Enter a comma-delimited list of categories to exclude from your log file. See filter, include, exclude for more details on how this process works.</p></div>
<div class="section">
<h3>dateformat<a name="dateformat"></a></h3>
<p>Setting a value for dateformat changes the date format value printed in the log file. No value prints the current time in milliseconds (unix time), a useful feature for parsing the log. The date format engine is Java&#x2019;s SimpleDateFormat class. Refer to the SimpleDateFormat class in the JavaDocs for information on setting this value. An example follows:</p>

<div class="source">
<pre>dateformat=MM-dd-yy HH:mm:ss:SS
</pre></div></div>
<div class="section">
<h3>stacktrace<a name="stacktrace"></a></h3>
<p>If stacktrace is set, the log prints out the stack trace for each SQL statement logged.</p></div>
<div class="section">
<h3>stacktraceclass<a name="stacktraceclass"></a></h3>
<p>Limits the stack traces printed to those that contain the value set in stacktraceclass. For example, specifying stacktraceclass=com.mycompany.myclass limits the printing of stack traces to the specified class value. The stack trace is converted to a String and string.indexOf(stacktraceclass) is performed.</p></div>
<div class="section">
<h3>reloadproperties and reloadpropertiesinterval<a name="reloadproperties_and_reloadpropertiesinterval"></a></h3>
<p>If reloadproperties is set to true, the property file is reloaded every n seconds, where n is defined by the value set by reloadpropertiesinterval. For example, if reloadproperties=true and reloadpropertiesinterval=10, the system checks the File.lastModified() property of the property file every 10 seconds, and if the file has been modified, it will be reloaded.</p>
<p>If you set append=true, the log will be suddenly truncated when you change your properties. This is because using reloadproperties is intended to be the equivalent of restarting your application server. Restarting your application server truncates your log file.</p>
<p>reloadproperties will not reload any driver information (such as realdriver, realdriver2, and realdriver3) and will not change the modules that are in memory.</p></div>
<div class="section">
<h3>useprefix<a name="useprefix"></a></h3>
<p>Setting useprefix to true requires you to prefix your URLs with p6spy:. The default setting is false.</p></div>
<div class="section">
<h3>logMessageFormat<a name="logMessageFormat"></a></h3>
<p>The log message format is selected by specifying the class to use to format the log messages. The following classes are available with P6Spy.</p>
<p><tt>com.p6spy.engine.spy.appender.SingleLineFormat</tt></p>
<p><tt>com.p6spy.engine.spy.appender.MultiLineFormat</tt></p>
<p>The MultiLineFormat might be better from a readability perspective. Because it will place the effective SQL statement on a separate line. However, the SingleLineFormat might be better if you have a need to parse the log messages. The default is SingleLineFormat for backward compatibility.</p>
<p>You can also supply your own log message formatter to customize the format. Simply create a class which implements the <tt>com.p6spy.engine.spy.appender.MessageFormattingStrategy</tt> interface and place it on the classpath.</p></div></div>
<div class="section">
<h2>Command Line Options<a name="Command_Line_Options"></a></h2>
<p>Every parameter specified in the property file can be set and overriden at the command line using the Java -D flag (system property), adding the the prefix: </p>

<div class="source">
<pre>p6spy.config.
</pre></div>
<p>An example follows:</p>

<div class="source">
<pre>java -Dp6spy.config.logfile=my.log -Dp6spy.config.append=true
</pre></div>
<p>Moreover to set different file to be used as the properties file (as an example: another_spy.properties), it should be specified using system property &#x201c;spy.properties&#x201d; as:</p>

<div class="source">
<pre>java -Dspy.properties=c:\jboss\lib\another_spy.properties
</pre></div></div>
<div class="section">
<h2>Log File Format<a name="Log_File_Format"></a></h2>
<p>The log file format of spy.log follows:</p>
<p>SingleLineFormat -</p>

<div class="source">
<pre>current time|execution time|category|statement SQL String|effective SQL string
</pre></div>
<p>MultiLineFormat -</p>

<div class="source">
<pre>current time|execution time|category|statement SQL String
effective SQL string
</pre></div>

<ul>
  
<li>current time&#x2014;The current time is obtained through System.getCurrentTimeMillis() and represents  the number of milliseconds that have passed since January 1, 1970 00:00:00.000 GMT.  (Refer to the J2SE documentation for further details on System.getCurrentTimeMillis().)  To change the format, use the dateformat property described in  <a href="#settings">Common Property File Settings</a>.</li>
  
<li>execution time&#x2014;The time it takes for a particular method to execute. (This is  not the total cost for the SQL statement.) For example, a statement  <tt>SELECT * FROM MYTABLE WHERE THISCOL = ?</tt> might be executed as a prepared  statement, in which the .execute() function will be measured. This is recorded as  the statement category. Further, as you call .next() on the ResultSet, each .next()  call is recorded in the result category.</li>
  
<li>category&#x2014;You can manage your log by including and excluding categories,  which is described in <a href="#settings">Common Property File Settings</a>.</li>
  
<li>statement SQL string&#x2014;This is the SQL string passed to the statement object.  If it is a prepared statement, it is the prepared statement that existed prior to  the parameters being set. To see the complete statement, refer to effective SQL string.</li>
  
<li>effective SQL string&#x2014;If you are not using a prepared statement, this contains no  value. Otherwise, it fills in the values of the Prepared Statement so you can see  the effective SQL statement that is passed to the database. Of course, the database  still sees the prepared statement, but this string is a convenient way to see the  actual values being sent to the database.</li>
</ul></div>
<div class="section">
<h2>P6Spy Modules<a name="P6Spy_Modules"></a></h2>
<p>P6Spy consists of two modules that provide various types of functionality which can be modified to suit your needs. These modules, P6Log and P6Outage, are explained in this section of the documentation. Though they have distinct functions, they share some <a href="#settings">Common Property File Settings</a> that allow you to specify which tables to log, the log file name, the log file location, whether to show the stacktrace (where the JDBC statement is being executed), and more. Refer to the <a href="#settings">Common Property File Settings</a> documentation for details.</p>
<div class="section">
<h3><a name="p6log">P6Log</a><a name="P6Log"></a></h3>
<p>P6Log is an open-source application included in the P6Spy distribution that intercepts and logs the database statements of any application that uses JDBC. This application monitors the SQL statements produced by EJB servers, enabling developers to write code that achieves maximum efficiency on the server. The P6Log module is enabled by default. Disable or enable the P6Log module by editing the spy.properties configuration file. If the module is commented out, it is not loaded, and the functionality is not available. If the module is not commented out, the functionality is available. The applicable portion of the spy.properties file follows:</p>

<div class="source">
<pre>#################################################################
# MODULES
#
# Modules provide the P6Spy functionality. If a module, such
# as module_log is commented out, that functionality will not
# be available. If it is not commented out (if it is active),
# the functionality will be active.
#
# Values set in Modules cannot be reloaded using the
# reloadproperties variable. Once they are loaded, they remain
# in memory until the application is restarted.
#
#################################################################
module.log=com.p6spy.engine.logging.P6LogSpyDriver

#module.outage=com.p6spy.engine.outage.P6OutageSpyDriver
</pre></div></div>
<div class="section">
<h3><a name="p6outage">P6Outage</a><a name="P6Outage"></a></h3>
<p>P6Outage is an open-source application included in the P6Spy distribution. P6Outage minimizes any logging performance overhead by logging only long-running statements. The P6Outage module is disabled by default. Disable or enable the P6Outage module by editing the spy.properties configuration file. If the module is commented out, it is not loaded, and the functionality is not available. If the module is not commented out, the functionality is available.</p>
<p>The applicable portion of the spy.properties file follows:</p>

<div class="source">
<pre>#################################################################
# MODULES
#
# Modules provide the P6Spy functionality. If a module, such
# as module_log is commented out, that functionality will not
# be available. If it is not commented out (if it is active),
# the functionality will be active.
#
# Values set in Modules cannot be reloaded using the
# reloadproperties variable. Once they are loaded, they remain
# in memory until the application is restarted.
#
#################################################################
#module.log=com.p6spy.engine.logging.P6LogSpyDriver

module.outage=com.p6spy.engine.outage.P6OutageSpyDriver
</pre></div>
<p>The following are P6Outage-specific properties:</p>

<ul>
  
<li>outagedetection - This feature detects long-running statements that may be indicative of a database outage problem. When enabled, it logs any statement that surpasses the configurable time boundary during its execution. No other statements are logged except the long-running statements.</li>
</ul>

<ul>
  
<li>outagedetectioninterval - The interval property is the boundary time set in seconds. For example, if set to 2, any statement requiring at least 2 seconds is logged. The same statement will continue to be logged for as long as it executes. So, if the interval is set to 2 and a query takes 11 seconds, it is logged 5 times (at the 2, 4, 6, 8, 10-second intervals).</li>
</ul></div>
<div class="section">
<h3><a name="p6leak">P6Leak</a><a name="P6Leak"></a></h3>
<p>P6Leak helps you to detect any JDBC resources which have not been properly closed. This includes connections, statements, and result sets.</p>
<p>Usage:</p>

<ol style="list-style-type: decimal">
  
<li>Uncomment the leak module in spy.properties.</li>
  
<li>Ensure that P6Spy is configured as per the <a href="install.html">installation instructions</a></li>
  
<li>Copy JDBCLeak.jsp (from distribution) to the root of your web application.</li>
  
<li>Start application and exercise it thoroughly for a while.</li>
  
<li>View JDBCLeak.jsp to view a stack trace for any JDBC leaks.</li>
  
<li>Halt the application and remove the leaks.</li>
  
<li>Repeat until no more leaks are detected.</li>
</ol>
<p>The P6Leak module is disabled by default. Disable or enable the P6Outage module by editing the spy.properties configuration file. If the module is commented out, it is not loaded, and the functionality is not available. If the module is not commented out, the functionality is available.</p>
<p>The applicable portion of the spy.properties file follows:</p>

<div class="source">
<pre>module.leak=com.p6spy.engine.leak.P6LeakFactory
</pre></div></div></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                    2002-2014
                      P6Spy.
            All Rights Reserved.      
                    
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
