<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia Site Renderer 1.4 at 2013-11-15 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>P6Spy - </title>
    <style type="text/css" media="all">
      @import url("../css/maven-base.css");
      @import url("../css/maven-theme.css");
      @import url("../css/site.css");
    </style>
    <link rel="stylesheet" href="../css/print.css" type="text/css" media="print" />
    <meta name="Date-Revision-yyyymmdd" content="20131115" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                    <div id="bannerLeft">
                P6Spy
                </div>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
                    
                  <div class="xright">        
                    
                 <span id="publishDate">Last Published: 2013-11-15</span>
              &nbsp;| <span id="projectVersion">Version: 2.0.0-SNAPSHOT</span>
            </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
                    
                                <h5>User's Guide</h5>
                  <ul>
                                                                                                                                                              <li class="collapsed">
                          <a href="../1.3/install.html" title="1.3">1.3</a>
                  </li>
                                                                                                                                                                        <li class="expanded">
            <strong>2.0</strong>
                  <ul>
                      <li class="none">
            <strong>Installation</strong>
          </li>
                      <li class="none">
                          <a href="../2.0/integration.html" title="Integration">Integration</a>
            </li>
                      <li class="none">
                          <a href="../2.0/configandusage.html" title="Configuration and Usage">Configuration and Usage</a>
            </li>
                      <li class="none">
                          <a href="../2.0/releasenotes.html" title="Release Notes">Release Notes</a>
            </li>
                      <li class="none">
                          <a href="../2.0/faq.html" title="FAQ">FAQ</a>
            </li>
                      <li class="none">
                          <a href="../2.0/troubleshooting.html" title="Troubleshooting">Troubleshooting</a>
            </li>
              </ul>
        </li>
          </ul>
                       <h5>Other</h5>
                  <ul>
                  <li class="none">
                          <a href="../thanks.html" title="Thanks">Thanks</a>
            </li>
                  <li class="none">
                          <a href="https://github.com/p6spy/p6spy/wiki/Download" class="externalLink" title="Download">Download</a>
            </li>
          </ul>
                       <h5>Project Documentation</h5>
                  <ul>
                                                                                                                                                                                                                    <li class="collapsed">
                          <a href="../project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                                                                                                                                <li class="collapsed">
                          <a href="../project-reports.html" title="Project Reports">Project Reports</a>
                  </li>
          </ul>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                   
                    
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <h1>P6Spy Installation</h1>
<p>This section will document the steps to install P6Spy on various application servers. In additional, it contains generic instructions for applications servers not listed as well as applications that do not use an application server. If you create instructions for other application servers, <a class="externalLink" href="http://p6spy.github.io/p6spy/mail-lists.html">send us a copy</a> for possible publication in the documentation.</p>
<p>The instructions for all application servers make the following assumptions.</p>

<ol style="list-style-type: decimal">
  
<li>
<p>The operating system is *nix. For Windows installations, the steps are the same but the syntax will be  a little different (environment variables, path separators, etc).</p></li>
  
<li>
<p>MySQL is the database being used. If you are using a different database, just substitute the JDBC connection URL and driver class  appropriate for your database.</p></li>
  
<li>
<p>Database connections are being obtained from a JNDI DataSource configured on the application server.  If the application does not use a JNDI DataSource, the instructions for modifying the data source  configuration will be incorrect. You will need to use the instructions as guidelines for modifying  the application specific database configuration. The instructions for adding the p6spy jar file and  spy.properties will still be correct.</p></li>
  
<li>
<p>You have already downloaded the <a class="externalLink" href="https://github.com/p6spy/p6spy/wiki/Download">P6Spy distribution</a> and  extracted the contents to a temporary directory. Throughout the rest of the instructions, the files included  in this temporary directory will be referenced by name only. </p></li>
  
<li>
<p>Your application is running on Java 1.6 or later. For earlier versions of Java, you will need to  use <a href="../1.3/install.html">P6Spy 1.3</a></p></li>
</ol>
<p>After you have completed the installation, a log file called <b>spy.log</b> will be created in the current working directory when the application runs. This log file will contain a list of the various database statements executed. You can alter the location of this log file as well as what gets logged by editing <b>spy.properties</b>. See <a href="configandusage.html#settings">Common Property File Settings</a> for the various configuration options available.</p>
<div class="section">
<h2>JBoss<a name="JBoss"></a></h2>
<p>The following sections contain specific information on installing P6Spy on <a href="#jboss5.x">JBoss 5.x</a></p>
<div class="section">
<h3><a name="jboss5.x">JBoss 5.x</a><a name="JBoss_5.x"></a></h3>
<p>The following instructions were tested with JBoss 5.2.0 EAP. For these instructions, P6Spy assumes that you are using the default server residing in <tt>$JBOSS_DIST\server\default</tt>, where $JBOSS_DIST is the directory in which JBoss is installed. </p>

<ol style="list-style-type: decimal">
  
<li>Move the <b>p6spy.jar</b> file to the <tt>$JBOSS_DIST\server\default\lib</tt> directory.</li>
  
<li>Move the <b>spy.properties</b> file to the <tt>$JBOSS_DIST\server\default\conf</tt> directory.</li>
  
<li>
<p>Update the connection URL and driver class for your data source in <tt>$JBOSS_DIST\server\default\deploy</tt>. This file  is normally called `?????-ds.xml&#x2019;. An example of the pertinent portions (not the complete XML file) follows:</p>
  
<div class="source">
<pre>&lt;jndi-name&gt;MySqlDS&lt;/jndi-name&gt;
&lt;connection-url&gt;jdbc:p6spy:mysql://&lt;hostname&gt;:&lt;port&gt;/&lt;database&gt;&lt;/connection-url&gt;
&lt;driver-class&gt;com.p6spy.engine.spy.P6SpyDriver&lt;/driver-class&gt;
</pre></div></li>
</ol></div></div>
<div class="section">
<h2>Apache Tomcat<a name="Apache_Tomcat"></a></h2>
<p>The following instructions were tested with Apache Tomcat 6.x. For these instructions, it is assumed that $CATALINA_HOME refers to the tomcat installation directory. Please be aware that there are many ways to configure JNDI data sources on tomcat.</p>

<ol style="list-style-type: decimal">
  
<li>Move the <b>p6spy.jar</b> file to the lib directory. An example of the path to your  lib directory is <tt>$CATALINA_HOME\lib\</tt>.</li>
  
<li>Move the <b>spy.properties</b> file to the conf directory. An example of the path to your  conf directory is <tt>$CATALINA_HOME\conf\</tt>.</li>
  
<li>
<p>Modify the JDBC connection URL and driver class for the data source. Please be aware that there are several places  where a JNDI data source may be defined. It is normally defined in a <tt>&lt;Resource/&gt;</tt> element in  <tt>$CATALINA_BASE/conf/server.xml</tt> or in the application specific <tt>$CATALINA_BASE/conf/catalina/localhost/????.xml</tt>.<br /> See <a class="externalLink" href="http://tomcat.apache.org/tomcat-6.0-doc/jndi-resources-howto.html#JDBC_Data_Sources">Tomcat JNDI Resources</a>  for specifics of where a data source is configured. An example of the pertinent portions of the resource definition  are shown below.</p>
  
<div class="source">
<pre>&lt;Resource name=&quot;jdbc/mydb&quot;
           type=&quot;javax.sql.DataSource&quot;
           ...
           driverClassName=&quot;com.p6spy.engine.spy.P6SpyDriver&quot;
           url=&quot;jdbc:p6spy:mysql://&lt;hostname&gt;:&lt;port&gt;/&lt;database&gt;&quot;
           ...
           /&gt;
</pre></div></li>
</ol></div>
<div class="section">
<h2><a name="unspec">Generic Instructions</a><a name="Generic_Instructions"></a></h2>
<p>The following installation instructions are intended for use with application servers not listed below and applications that do not use application servers. To install P6Spy, complete the following steps:</p>

<ol style="list-style-type: decimal">
  
<li>Put the <b>p6spy.jar</b> file in your classpath.</li>
  
<li>Put <b>spy.properties</b> into a directory which is on the classpath. Many application servers have a directory for  configuration files which are accessible via the classpath. Most applications which do not run an application  server will have one as well.</li>
  
<li>Configure the data source.</li>
</ol>
<p>If the JNDI DataSource is configured using a driver class (implements javax.sql.Driver), then you should modify the JDBC connection URL to include &#x2018;p6spy:&#x2019; and update the driver class to <tt>com.p6spy.engine.spy.P6SpyDriver</tt>. Example URL including p6spy: <tt>jdbc:p6spy:mysql://&lt;hostname&gt;:&lt;port&gt;/&lt;database&gt;</tt>.</p>
<p>If the JNDI DataSource is configured using a data source class (implements javax.sql.DataSource) then you will need to create a &#x2018;proxy&#x2019; data source using the following instructions. </p>

<ol style="list-style-type: decimal">
  
<li>Rename the JNDI name of the current data source to something else. For example, if the current name is &#x2018;jdbc/myds&#x2019;, then change it to &#x2018;jdbc/myds-real&#x2019;.</li>
  
<li>Create a new JNDI DataSource with the original name of the real data source. Continuing with the example from above, the JNDI name should be &#x2018;jdbc/myds&#x2019;.</li>
  
<li>Create one property for the data source called &#x2018;RealDataSource&#x2019;. The value of this property should be &#x2018;jdbc/myds-real&#x2019;</li>
  
<li>Set the class or implementation to <tt>com.p6spy.engine.spy.P6DataSource</tt>.</li>
  
<li>If the application server requires a classpath for the datasource, it should include p6spy.jar and spy.properties.</li>
</ol></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                    2013
                      P6Spy.
            All Rights Reserved.      
                    
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
