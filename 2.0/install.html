<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia Site Renderer 1.4 at 2014-10-08 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>P6Spy - </title>
    <style type="text/css" media="all">
      @import url("../css/maven-base.css");
      @import url("../css/maven-theme.css");
      @import url("../css/site.css");
    </style>
    <link rel="stylesheet" href="../css/print.css" type="text/css" media="print" />
    <meta name="Date-Revision-yyyymmdd" content="20141008" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                    <div id="bannerLeft">
                P6Spy
                </div>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
                    
                  <div class="xright">        
                    
                 <span id="publishDate">Last Published: 2014-10-08</span>
              &nbsp;| <span id="projectVersion">Version: 2.1.2-SNAPSHOT</span>
            </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
                    
                                <h5>User's Guide</h5>
                  <ul>
                                                                                                                                                              <li class="collapsed">
                          <a href="../1.3/install.html" title="1.3">1.3</a>
                  </li>
                                                                                                                                                                                                            <li class="expanded">
            <strong>2.x</strong>
                  <ul>
                      <li class="none">
            <strong>Installation</strong>
          </li>
                      <li class="none">
                          <a href="../2.0/integration.html" title="Integration">Integration</a>
            </li>
                      <li class="none">
                          <a href="../2.0/configandusage.html" title="Configuration and Usage">Configuration and Usage</a>
            </li>
                      <li class="none">
                          <a href="../2.0/releasenotes.html" title="Release Notes">Release Notes</a>
            </li>
                      <li class="none">
                          <a href="../2.0/knownissues.html" title="Known Issues">Known Issues</a>
            </li>
                      <li class="none">
                          <a href="../2.0/faq.html" title="FAQ">FAQ</a>
            </li>
                      <li class="none">
                          <a href="../2.0/troubleshooting.html" title="Troubleshooting">Troubleshooting</a>
            </li>
                      <li class="none">
                          <a href="../2.0/development.html" title="Development">Development</a>
            </li>
              </ul>
        </li>
          </ul>
                       <h5>Other</h5>
                  <ul>
                  <li class="none">
                          <a href="../thanks.html" title="Thanks">Thanks</a>
            </li>
                  <li class="none">
                          <a href="https://github.com/p6spy/p6spy/wiki/Download" class="externalLink" title="Download">Download</a>
            </li>
          </ul>
                       <h5>Project Documentation</h5>
                  <ul>
                                                                                                                                                                                                                    <li class="collapsed">
                          <a href="../project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                                                                                                                                                  <li class="collapsed">
                          <a href="../project-reports.html" title="Project Reports">Project Reports</a>
                  </li>
          </ul>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                   
                    
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <h1>P6Spy Installation</h1>
<p>This section will document the steps to install P6Spy on various application servers. In additional, it contains generic instructions for applications servers not listed as well as applications that do not use an application server. If you create instructions for other application servers, <a class="externalLink" href="http://p6spy.github.io/p6spy/mail-lists.html">send us a copy</a> for possible publication in the documentation.</p>
<p>The instructions for all application servers make the following assumptions.</p>

<ol style="list-style-type: decimal">
  
<li>
<p>The operating system is *nix. For Windows installations, the steps are the same but the syntax will be  a little different (environment variables, path separators, etc).</p></li>
  
<li>
<p>MySQL is the database being used. If you are using a different database, just substitute the JDBC connection URL and driver class  appropriate for your database.</p></li>
  
<li>
<p>Database connections are being obtained from a JNDI DataSource configured on the application server.  If the application does not use a JNDI DataSource, the instructions for modifying the data source  configuration will be incorrect. You will need to use the instructions as guidelines for modifying  the application specific database configuration. The instructions for adding the p6spy jar file and  spy.properties will still be correct.</p></li>
  
<li>
<p>You have already downloaded the <a class="externalLink" href="https://github.com/p6spy/p6spy/wiki/Download">P6Spy distribution</a> and  extracted the contents to a temporary directory. Throughout the rest of the instructions, the files included  in this temporary directory will be referenced by name only. </p></li>
  
<li>
<p>Your application is running on Java 1.6 or later. For earlier versions of Java, you will need to  use <a href="../1.3/install.html">P6Spy 1.3</a></p></li>
</ol>
<p>After you have completed the installation, a log file called <b>spy.log</b> will be created in the current working directory when the application runs. This log file will contain a list of the various database statements executed. You can alter the location of this log file as well as what gets logged by editing <b>spy.properties</b>. See <a href="configandusage.html#settings">Common Property File Settings</a> for the various configuration options available.</p>
<p>Application Servers:<br /><a href="#jboss">JBoss/WildFly</a><br /><a href="#tomcat">Apache Tomcat and Apache TomEE</a><br /><a href="#glassfish">Glassfish</a><br /><a href="#generic">Generic</a> </p>
<div class="section">
<h2><a name="jboss">JBoss/WildFly</a><a name="JBossWildFly"></a></h2>
<p>The following sections contain specific information on installing P6Spy on <a href="#jboss5">JBoss 4.2.x-6.1.x</a> and <a href="#jboss71">JBoss 7.1.x and WildFly 8.x</a></p>
<p>Please note <b>XA Datasource proxying IS NOT supported</b> for these. </p>
<div class="section">
<h3><a name="jboss5">JBoss 4.2.x, 5.1.x, 6.1.x and JBoss 5.x EAP</a><a name="JBoss_4.2.x_5.1.x_6.1.x_and_JBoss_5.x_EAP"></a></h3>
<p>The following instructions were tested with JBoss 4.2.3.GA, 5.1.0.GA, 6.1.0.Final and JBoss 5.2.0 EAP. For these instructions, P6Spy assumes that you are using the default server residing in <tt>$JBOSS_DIST\server\default</tt>, where $JBOSS_DIST is the directory in which JBoss is installed.</p>

<ol style="list-style-type: decimal">
  
<li>Move the <b>p6spy.jar</b> file to the <tt>$JBOSS_DIST\server\default\lib</tt> directory.</li>
  
<li>Move the <b>spy.properties</b> file to the <tt>$JBOSS_DIST\server\default\conf</tt> directory.</li>
  
<li>
<p>Update the connection URL and driver class for your data source in <tt>$JBOSS_DIST\server\default\deploy</tt>. This file  is normally called <tt>?????-ds.xml</tt>. An example of the pertinent portions (not the complete XML file) follows:</p>
  
<div class="source">
<pre>&lt;jndi-name&gt;MySqlDS&lt;/jndi-name&gt;
&lt;connection-url&gt;jdbc:p6spy:mysql://&lt;hostname&gt;:&lt;port&gt;/&lt;database&gt;&lt;/connection-url&gt;
&lt;driver-class&gt;com.p6spy.engine.spy.P6SpyDriver&lt;/driver-class&gt;
</pre></div></li>
</ol></div>
<div class="section">
<h3><a name="jboss71url">JBoss 7.1.x, WildFly 8.x - modified URL</a><a name="JBoss_7.1.x_WildFly_8.x_-_modified_URL"></a></h3>
<p>The following instructions were tested with JBoss 7.1.0 and Wildfly 8.1.CR1 (works with p6spy version 2.1.0 or higher). For these instructions, P6Spy assumes that you are using the standalone and $JBOSS_DIST is the directory in which JBoss/WildFly is installed. </p>

<ol style="list-style-type: decimal">
  
<li>
<p>Deploy <b>p6spy.jar</b> as a module:</p>
  
<ul>
    
<li>via moving it to to the <tt>$JBOSS_DIST\modules\system\layers\base\com\p6spy\main</tt> (for Wildfly) or to <tt>$JBOSS_DIST\modules\com\p6spy\main</tt> (for JBoss 7.1) directory</li>
    
<li>and via providing <tt>module.xml</tt> in the same directory with the contents:</li>
  </ul>
  
<div class="source">
<pre>&lt;module xmlns=&quot;urn:jboss:module:1.0&quot; name=&quot;com.p6spy&quot;&gt;
    &lt;resources&gt;
        &lt;resource-root path=&quot;p6spy-2.0.3.jar&quot;/&gt;
    &lt;/resources&gt;
    &lt;dependencies&gt;
        &lt;module name=&quot;javax.api&quot;/&gt;
        &lt;module name=&quot;javax.transaction.api&quot;/&gt;
        &lt;!-- make sure to refer to module holding real driver --&gt;
        &lt;module name=&quot;com.h2database.h2&quot;/&gt;
    &lt;/dependencies&gt;
&lt;/module&gt;
</pre></div>
<p>please note, that p6spy-2.0.3 version jar is used in the sample configuration. Moreover the reference to module holding the real (proxied) jdbc driver has to be provided (in the sample case is h2 one used). </p></li>
  
<li>
<p>Move the <b>spy.properties</b> file to the <tt>$JBOSS_DIST\bin</tt> directory.</p></li>
  
<li>
<p>Update the connection URL and driver section in your <tt>&lt;datasources&gt;</tt> in <tt>$JBOSS_DIST\standalone\configuration\standalone.xml</tt>. An example of the pertinent portions (not the complete XML file) follows:</p>
  
<div class="source">
<pre>&lt;datasources&gt;
    &lt;datasource jndi-name=&quot;java:/jdbc/p6spy&quot; enabled=&quot;true&quot; use-java-context=&quot;true&quot; pool-name=&quot;p6spyPool&quot;&gt;
       &lt;connection-url&gt;jdbc:p6spy:h2:tcp://&lt;hostname&gt;:&lt;port&gt;/&lt;database&gt;&lt;/connection-url&gt;
        &lt;driver&gt;p6spy&lt;/driver&gt;
       ...
    &lt;/datasource&gt;

    &lt;drivers&gt;
        &lt;driver name=&quot;p6spy&quot; module=&quot;com.p6spy&quot;&gt;
            &lt;driver-class&gt;com.p6spy.engine.spy.P6SpyDriver&lt;/driver-class&gt;
        &lt;/driver&gt;
        ...
    &lt;/drivers&gt;
&lt;/datasources&gt;
</pre></div></li>
</ol></div></div>
<div class="section">
<h2><a name="tomcat">Apache Tomcat and Apache TomEE</a><a name="Apache_Tomcat_and_Apache_TomEE"></a></h2>
<p>The following sections contain specific information on installing P6Spy on <a href="#tomcat_tomee">Tomcat 6.x, 7.x, 8.x and TomEE 1.6.x</a>.</p>
<div class="section">
<h3><a name="tomcat_tomee">Apache Tomcat 6.x, 7.x, 8.x and TomEE 1.6.x</a><a name="Apache_Tomcat_6.x_7.x_8.x_and_TomEE_1.6.x"></a></h3>
<p>The following instructions were tested with Apache Tomcat versions: 6.0.34, 7.0.54 and 8.0.0-RC5 as well as Apache TomEE 1.6.0.2 Webprofile and Apache TomEE 1.6.0.2 Plus. For these instructions, it is assumed that $CATALINA_HOME refers to the tomcat/tomee installation directory. Please be aware that there are many ways to configure JNDI data sources on tomcat/tomee.</p>

<ol style="list-style-type: decimal">
  
<li>Move the <b>p6spy.jar</b> file to the lib directory. An example of the path to your  lib directory is <tt>$CATALINA_HOME\lib\</tt>.</li>
  
<li>Move the <b>spy.properties</b> file to the lib directory. An example of the path to your  lib directory is <tt>$CATALINA_HOME\lib\</tt>.</li>
  
<li>
<p>Configure the class name of the real JDBC driver in <b>spy.properties</b></p>
  
<div class="source">
<pre>driverlist=com.mysql.jdbc.Driver
</pre></div></li>
  
<li>
<p>Modify the JDBC connection URL and driver class for the data source. Please be aware that there are several places  where a JNDI data source may be defined. It is normally defined in a <tt>&lt;Resource/&gt;</tt> element in  <tt>$CATALINA_BASE/conf/server.xml</tt> or in the application specific <tt>$CATALINA_BASE/conf/catalina/localhost/????.xml</tt>.<br /> See <a class="externalLink" href="http://tomcat.apache.org/tomcat-6.0-doc/jndi-resources-howto.html#JDBC_Data_Sources">Tomcat 6 JNDI Resources</a>/<a class="externalLink" href="http://tomcat.apache.org/tomcat-7.0-doc/jndi-resources-howto.html#JDBC_Data_Sources">Tomcat 7 JNDI Resources</a>/<a class="externalLink" href="http://tomcat.apache.org/tomcat-8.0-doc/jndi-datasource-examples-howto.html">Tomcat 8 JNDI Resources</a>  for specifics of where a data source is configured. An example of the pertinent portions of the resource definition  are shown below.</p>
  
<div class="source">
<pre>&lt;Resource name=&quot;jdbc/mydb&quot;
           type=&quot;javax.sql.DataSource&quot;
           ...
           driverClassName=&quot;com.p6spy.engine.spy.P6SpyDriver&quot;
           url=&quot;jdbc:p6spy:mysql://&lt;hostname&gt;:&lt;port&gt;/&lt;database&gt;&quot;
           ...
           /&gt;
</pre></div></li>
</ol></div></div>
<div class="section">
<h2><a name="glassfish">Glassfish</a><a name="Glassfish"></a></h2>
<p>The following section contains specific information on installing P6Spy on <a href="#glassfish3122_40">Glassfish 3.1.x and 4.0.x</a> (works with p6spy version 2.1.0 or higher).</p>
<p>Please note <b>XA Datasource proxying IS supported</b> for these. </p>
<div class="section">
<h3><a name="glassfish3122_40">Glassfish 3.1.2.2 and Glassfish 4.0</a><a name="Glassfish_3.1.2.2_and_Glassfish_4.0"></a></h3>
<p>The provided instructions were tested with Glassfish OSE 3.1.2.2 and Glassfish OSE 4.0. In later section is <tt>$GLASSFISH_HOME</tt> the directory where Glassfish is installed and <tt>$DOMAIN_X</tt> is the domain name used for deployment (for example, can be: <tt>domain1</tt>).</p>

<ol style="list-style-type: decimal">
  
<li>Move the <b>p6spy.jar</b> file to the <tt>$GLASSFISH_HOME/domains/$DOMAIN_X/lib/ext</tt> directory.</li>
  
<li>Move the <b>spy.properties</b> file to the <tt>$GLASSFISH_HOME/domains/$DOMAIN_X/config</tt> directory.</li>
  
<li>
<p>Configure new datasource. Please note there are 3 configuration options available:</p>
  
<ul>
    
<li>updating JDBC Url if using <tt>java.sql.Driver</tt></li>
  </ul>
<p>using command line:</p>
  
<div class="source">
<pre>    # create jdbc connection pool      
    asadmin create-jdbc-connection-pool --driverclassname=com.p6spy.engine.spy.P6SpyDriver --restype=java.sql.Driver --property=URL='jdbc:p6spy:h2:tcp://&lt;hostname&gt;:&lt;port&gt;/&lt;database&gt;':User='&lt;username&gt;':Password='&lt;password&gt;' p6spyPool

    # ping the pool to prove it works (optionally)
    asadmin ping-connection-pool p6spyPool

    # create jdbc resource
    asadmin --user=&lt;asadmin_user&gt; --passwordfile=&lt;sample_passworfile.properties&gt; create-jdbc-resource --connectionpoolid=p6spyPool jdbc/p6Spy
</pre></div>
<p>or directly by editing <tt>$GLASSFISH_HOME/domains/$DOMAIN_X/config/domain.xml</tt> (please note the previous commands would lead to similar added to your config file):</p>
  
<div class="source">
<pre>    &lt;jdbc-connection-pool driver-classname=&quot;com.p6spy.engine.spy.P6SpyDriver&quot; res-type=&quot;java.sql.Driver&quot; name=&quot;p6spyPool&quot;&gt;
        &lt;property name=&quot;URL&quot; value=&quot;jdbc:p6spy:h2:tcp://&lt;hostname&gt;:&lt;port&gt;/&lt;database&gt;&quot;&gt;&lt;/property&gt;
     &lt;property name=&quot;Password&quot; value=&quot;&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;User&quot; value=&quot;sa&quot;&gt;&lt;/property&gt;
    &lt;/jdbc-connection-pool&gt;
    &lt;jdbc-resource pool-name=&quot;p6spyPool&quot; jndi-name=&quot;jdbc/p6spy&quot;&gt;&lt;/jdbc-resource&gt;
</pre></div>
  
<ul>
    
<li><tt>javax.sql.ConnectionPoolDataSource</tt> proxying (via additional datasource)</li>
  </ul>
<p>using command line:</p>
  
<div class="source">
<pre>    # create jdbc connection pool
    asadmin create-jdbc-connection-pool --datasourceclassname=com.p6spy.engine.spy.P6DataSource --restype=javax.sql.ConnectionPoolDataSource --property=realDataSource='&lt;realDSJndi&gt;':User='&lt;username&gt;':Password='&lt;password&gt;' p6spyPool

    # ping the pool to prove it works (optionally)
    asadmin ping-connection-pool p6spyPool

    # create jdbc resource        
    asadmin --user=&lt;asadmin_user&gt; --passwordfile=&lt;sample_passworfile.properties&gt; create-jdbc-resource --connectionpoolid=p6spyPool jdbc/p6Spy
</pre></div>
<p>or directly by editing <tt>$GLASSFISH_HOME/domains/$DOMAIN_X/config/domain.xml</tt> (please note the previous commands would lead to similar added to your config file):</p>
  
<div class="source">
<pre>    &lt;jdbc-connection-pool datasource-classname=&quot;com.p6spy.engine.spy.P6DataSource&quot; res-type=&quot;javax.sql.ConnectionPoolDataSource&quot; name=&quot;p6spyPool&quot;&gt;
      &lt;property name=&quot;realDataSource&quot; value=&quot;jdbc/&lt;realDSJndi&gt;&quot;&gt;&lt;/property&gt;
      &lt;property name=&quot;Password&quot; value=&quot;&quot;&gt;&lt;/property&gt;
      &lt;property name=&quot;User&quot; value=&quot;sa&quot;&gt;&lt;/property&gt;
    &lt;/jdbc-connection-pool&gt;
    &lt;jdbc-resource pool-name=&quot;p6spyPool&quot; jndi-name=&quot;jdbc/p6spy&quot;&gt;&lt;/jdbc-resource&gt;     
</pre></div>
  
<ul>
    
<li><tt>javax.sql.XADataSource</tt> proxying (via additional datasource)</li>
  </ul>
<p>using command line:</p>
  
<div class="source">
<pre>    # create jdbc connection pool
    asadmin create-jdbc-connection-pool --datasourceclassname=com.p6spy.engine.spy.P6DataSource --restype=javax.sql.XADataSource --property=realDataSource='&lt;realDSJndi&gt;':User='&lt;username&gt;':Password='&lt;password&gt;' p6spyPool

    # ping the pool to prove it works (optionally)
    asadmin ping-connection-pool p6spyPool

    # create jdbc resource        
    asadmin --user=&lt;asadmin_user&gt; --passwordfile=&lt;sample_passworfile.properties&gt; create-jdbc-resource --connectionpoolid=p6spyPool jdbc/p6Spy
</pre></div>
<p>or directly by editing <tt>$GLASSFISH_HOME/domains/$DOMAIN_X/config/domain.xml</tt> (please note the previous commands would lead to similar added to your config file):</p>
  
<div class="source">
<pre>    &lt;jdbc-connection-pool datasource-classname=&quot;com.p6spy.engine.spy.P6DataSource&quot; res-type=&quot;javax.sql.XADataSource&quot; name=&quot;p6spyPool&quot;&gt;
      &lt;property name=&quot;realDataSource&quot; value=&quot;jdbc/&lt;realDSJndi&gt;&quot;&gt;&lt;/property&gt;
      &lt;property name=&quot;Password&quot; value=&quot;&quot;&gt;&lt;/property&gt;
      &lt;property name=&quot;User&quot; value=&quot;sa&quot;&gt;&lt;/property&gt;
    &lt;/jdbc-connection-pool&gt;
    &lt;jdbc-resource pool-name=&quot;p6spyPool&quot; jndi-name=&quot;jdbc/p6spy&quot;&gt;&lt;/jdbc-resource&gt;     
</pre></div>
<p>Please note, you need to replace following:</p>
  
<ul>
    
<li><tt>&lt;asadmin_user&gt;</tt> - asadmin user name (by default <tt>asadmin</tt>)</li>
    
<li><tt>&lt;sample_passworfile.properties&gt;</tt> - is a properties file, that should hold your asadmin password (by default should hold: <tt>AS_ADMIN_ADMINPASSWOD=adminadmin</tt>)</li>
    
<li><tt>&lt;username&gt;</tt> - username to be used for the DB access</li>
    
<li><tt>&lt;password&gt;</tt> - password to be used for DB access</li>
    
<li><tt>&lt;hostname&gt;</tt> - DB server hostname</li>
    
<li><tt>&lt;port&gt;</tt> - DB server port</li>
    
<li><tt>&lt;database&gt;</tt> - DB server database</li>
    
<li><tt>&lt;realDSJndi&gt;</tt> - jndi-name of the real datasource to be proxied</li>
  </ul>
<p>And the jndi name of the created jndi resource in the sample configurations is: <tt>jdbc/p6spy</tt></p></li>
</ol></div></div>
<div class="section">
<h2><a name="generic">Generic Instructions</a><a name="Generic_Instructions"></a></h2>
<p>The following installation instructions are intended for use with other application servers and applications that do not use application servers. To install P6Spy, complete the following steps:</p>

<ol style="list-style-type: decimal">
  
<li>Put the <b>p6spy.jar</b> file in your classpath.</li>
  
<li>Put <b>spy.properties</b> into a directory which is on the classpath. Many application servers have a directory for  configuration files which are accessible via the classpath. Most applications which do not run an application  server will have one as well.</li>
  
<li>
<p>Configure the class name of the real JDBC driver in <b>spy.properties</b></p>
  
<div class="source">
<pre>driverlist=com.mysql.jdbc.Driver
</pre></div></li>
  
<li>
<p>Configure the data source.</p></li>
</ol>
<p>If the JNDI DataSource is configured using a driver class (implements javax.sql.Driver), then you should modify the JDBC connection URL to include &#x2018;p6spy:&#x2019; and update the driver class to <tt>com.p6spy.engine.spy.P6SpyDriver</tt>. Example URL including p6spy: <tt>jdbc:p6spy:mysql://&lt;hostname&gt;:&lt;port&gt;/&lt;database&gt;</tt>.</p>
<p>If the JNDI DataSource is configured using a data source class (implements javax.sql.DataSource) then you will need to create a &#x2018;proxy&#x2019; data source using the following instructions. </p>

<ol style="list-style-type: decimal">
  
<li>Rename the JNDI name of the current data source to something else. For example, if the current name is &#x2018;jdbc/myds&#x2019;, then change it to &#x2018;jdbc/myds-real&#x2019;.</li>
  
<li>Create a new JNDI DataSource with the original name of the real data source. Continuing with the example from above, the JNDI name should be &#x2018;jdbc/myds&#x2019;.</li>
  
<li>Create one property for the data source called &#x2018;RealDataSource&#x2019;. The value of this property should be &#x2018;jdbc/myds-real&#x2019;</li>
  
<li>Set the class or implementation to <tt>com.p6spy.engine.spy.P6DataSource</tt>.</li>
  
<li>If the application server requires a classpath for the datasource, it should include p6spy.jar and spy.properties.</li>
</ol></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                    2002-2014
                      P6Spy.
            All Rights Reserved.      
                    
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
