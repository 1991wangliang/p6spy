<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia Site Renderer 1.4 at 2013-11-15 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>P6Spy - </title>
    <style type="text/css" media="all">
      @import url("../css/maven-base.css");
      @import url("../css/maven-theme.css");
      @import url("../css/site.css");
    </style>
    <link rel="stylesheet" href="../css/print.css" type="text/css" media="print" />
    <meta name="Date-Revision-yyyymmdd" content="20131115" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                    <div id="bannerLeft">
                P6Spy
                </div>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
                    
                  <div class="xright">        
                    
                 <span id="publishDate">Last Published: 2013-11-15</span>
              &nbsp;| <span id="projectVersion">Version: 2.0.0-SNAPSHOT</span>
            </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
                    
                                <h5>User's Guide</h5>
                  <ul>
                                                                                                                                                                        <li class="expanded">
            <strong>1.3</strong>
                  <ul>
                      <li class="none">
            <strong>Installation</strong>
          </li>
                      <li class="none">
                          <a href="../1.3/configandusage.html" title="Configuration and Usage">Configuration and Usage</a>
            </li>
                      <li class="none">
                          <a href="../1.3/releasenotes.html" title="Release Notes">Release Notes</a>
            </li>
                      <li class="none">
                          <a href="../1.3/knownissues.html" title="Known Issues">Known Issues</a>
            </li>
                      <li class="none">
                          <a href="../1.3/faq.html" title="FAQ">FAQ</a>
            </li>
                      <li class="none">
                          <a href="../1.3/troubleshooting.html" title="Troubleshooting">Troubleshooting</a>
            </li>
              </ul>
        </li>
                                                                                                                                                              <li class="collapsed">
                          <a href="../2.0/install.html" title="2.0">2.0</a>
                  </li>
          </ul>
                       <h5>Other</h5>
                  <ul>
                  <li class="none">
                          <a href="../thanks.html" title="Thanks">Thanks</a>
            </li>
                  <li class="none">
                          <a href="https://github.com/p6spy/p6spy/wiki/Download" class="externalLink" title="Download">Download</a>
            </li>
          </ul>
                       <h5>Project Documentation</h5>
                  <ul>
                                                                                                                                                                                                                    <li class="collapsed">
                          <a href="../project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                                                                                                                                <li class="collapsed">
                          <a href="../project-reports.html" title="Project Reports">Project Reports</a>
                  </li>
          </ul>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                   
                    
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <h1>P6Spy Installation</h1>
<p>This installation documentation contains instructions for installing P6Spy with various application servers. In addition, it contains general installation instructions for application servers not listed and applications that do not use application servers. Keep in mind that the <a href="install.html#unspec">Unspecified Application Server</a> instructions do not contain details specific to your application server. Use them only as a guideline. If you create instructions for other application servers, send us a copy for possible publication in the documentation.</p>
<p>The installed P6Spy software offers many configuration options. See <a href="configandusage.html#settings">Common Property File Settings</a> for additional information.</p>
<div class="section">
<h2>JBoss<a name="JBoss"></a></h2>
<p>The following sections contain specific information on installing P6Spy on <a href="#jboss2">JBoss 2.x</a> and <a href="#jboss3">JBoss 3.x.</a></p>
<div class="section">
<h3><a name="jboss2">JBoss 2.x</a><a name="JBoss_2.x"></a></h3>
<p>The following instructions were tested with various JBoss versions ranging from JBoss 2.2.2-2.4.4 with Jakarta Tomcat 3.2.2-4.0.1 integration. To install P6Spy on JBoss 2.x, complete the following steps:</p>

<ol style="list-style-type: decimal">
  
<li>Extract the <b>p6spy-install.jar</b> file. The <b>p6spy-install.jar</b> file contains  <b>p6spy.jar</b> and <b>spy.properties</b>.</li>
  
<li>Move the <b>p6spy.jar</b> file to the directory. An example of the path to your ext directory is  <tt>C:\JBoss-2.2.2_Tomcat-3.2.2\jboss\lib\ext</tt>.</li>
  
<li>Move the <b>spy.properties</b> file to the db directory, which is part of the JBoss classpath.  An example of the path to your db directory is C:\JBoss-2.2.2_Tomcat-3.2.2\jboss\db.</li>
  
<li>
<p>Modify the<b>jboss.jcml</b> file in the Tomcat conf directory to use the P6Spy driver, by removing  your existing driver from the Drivers attribute and replacing it with the P6Spy driver. An example  of an edited <b>jboss.jcml</b> file follows:</p>
  
<div class="source">
<pre>&lt;mbean code=&quot;org.jboss.jdbc.JdbcProvider&quot; name=&quot;DefaultDomain:service=JdbcProvider&quot;&gt;
  &lt;attribute name=&quot;Drivers&quot;&gt;com.p6spy.engine.spy.P6SpyDriver&lt;/attribute&gt;
&lt;/mbean&gt;
</pre></div></li>
  
<li>
<p>Modify the realdriver line in the <b>spy.properties</b> file to reflect the wrapped database driver.  An example of a modified realdriver line follows:</p>
  
<div class="source">
<pre>realdriver = oracle.jdbc.driver.OracleDriver
</pre></div></li>
</ol>
<p>Installation is complete. When you run your application, a <b>spy.log</b> file is generated in the bin directory of the JBoss server. The log file contains a list of all of the database statements executed. You can change both the destination of <b>spy.log</b> and what it logs by editing the <b>spy.properties</b> file (see <a href="configandusage.html#settings">Common Property File Settings</a>).</p></div>
<div class="section">
<h3><a name="jboss3">JBoss 3.x</a><a name="JBoss_3.x"></a></h3>
<p>(Contributed by Alan Arvesen, IronGrid)</p>
<p>The following instructions were tested with JBoss 3.0.4 with Jetty integration. For these instructions, P6Spy assumes that you are using the default server residing in <tt>JBOSS_DIST\server\default</tt>, where JBOSS_DIST is the directory in which JBoss is installed. These instructions are intended for wrapping driver services, not XADataSource services. To install P6Spy on JBoss 3.x, complete the following steps:</p>

<ol style="list-style-type: decimal">
  
<li>Extract the <b>p6spy-install.jar</b> file. The <b>p6spy-install.jar</b> file contains <b>p6spy.jar</b> and <b>spy.properties</b>.</li>
  
<li>Move the <b>p6spy.jar</b> file to the lib directory. An example of the path to your lib directory is  <tt>C:\java\jbossext-3.0.4\server\default\lib</tt>.</li>
  
<li>
<p>Add <b>spy.properties</b> to your JBoss classpath. By default, the JBoss classpath set up by <b>run.bat</b>  only points to <b>tools.jar</b> and <b>run.jar</b>. You may need to add a directory, via JBOSS_CLASSPATH, to this path.  An example of an edited JBoss classpath follows:</p>
  
<div class="source">
<pre>C:\&gt; set JBOSS_CLASSPATH=C:\java\jboss-3.0.4\server\default\db

C:\&gt; copy C:\java\p6spy\spy.* C:\java\jboss-3.0.4\server\default\db
</pre></div></li>
  
<li>
<p>Create a <b>p6spy-service.xml</b> file in JBOSS_DIST\server\deploy. Set the config-property element named  DriverClass to <b>P6SpyDriver</b> in <b>p6spy-service.xml</b>, by basing a new XML file on one of the examples in  the <tt>JBOSS_DIST\docs\examples\jca</tt> directory. You can also configure JndiName and ConnectionURL for your  specific implementation. An example of the pertinent portions (not the complete XML file) of a  <b>p6spy-service.xml</b> file follows:</p>
  
<div class="source">
<pre>&lt;attribute name=&quot;JndiName&quot;&gt;MySqlDS&lt;/attribute&gt;
&lt;attribute name=&quot;ManagedConnectionFactoryProperties&quot;&gt;
&lt;properties&gt;
&lt;config-property name=&quot;ConnectionURL&quot; type=&quot;java.lang.String&quot;&gt;jdbc:mysql://localhost/localdb&lt;/config-property&gt;
&lt;config-property name=&quot;DriverClass&quot;type=&quot;java.lang.String&quot;&gt;com.p6spy.engine.spy.P6SpyDriver&lt;/config-property&gt;
</pre></div></li>
</ol>
<p><b>Note:</b> Make sure there is not a service that explicitly loads the wrapped driver. A service of this type will load the specified driver before P6SpyDriver, resulting in unwrapped connections. Modify the realdriver line in the <b>spy.properties</b> file to reflect the wrapped database driver. An example of a modified realdriver line follows:</p>

<div class="source">
<pre>    realdriver=org.gjt.mm.mysql.Driver
</pre></div>
<p>Installation is complete. When you run your application, a log file ( <b>spy.log</b> ) is generated in the bin directory of the JBoss server. The log file contains a list of all of the database statements executed. You can change both the destination of <b>spy.log</b> and what it logs by editing the <b>spy.properties</b> file (see <a href="configandusage.html#settings">Common Property File Settings</a>).</p></div></div>
<div class="section">
<h2>Orion<a name="Orion"></a></h2>
<p>The following instructions were tested with Orion. To install P6Spy on Orion, complete the following steps:</p>

<ol style="list-style-type: decimal">
  
<li>Extract the <b>p6spy-install.jar</b> file. The <b>p6spy-install.jar</b> file contains <b>p6spy.jar</b> and <b>spy.properties</b>.</li>
  
<li>Move <b>p6spy.jar</b> and <b>spy.properties</b> to the orion-home\lib directory, where orion-home is the  directory in which Orion is installed. An example of the path to your orion-home\lib directory is <tt>C:\orion\lib</tt>.</li>
  
<li>
<p>Modify the connection-driver line in <b>data-sources.xml</b> to use P6SpyDriver. <b>data-sources.xml</b>  resides in orion-home\config. An example of an edited <b>data-sources.xml</b> file follows:</p>
  
<div class="source">
<pre>&lt;data-source
class=&quot;com.evermind.sql.DriverManagerDataSource&quot;
name=&quot;Hypersonic&quot;
location=&quot;jdbc/HypersonicCoreDS&quot;
xa-location=&quot;jdbc/xa/HypersonicXADS&quot;
ejb-location=&quot;jdbc/HypersonicDS&quot;
connection-driver=&quot;com.p6spy.engine.spy.P6SpyDriver&quot;
username=&quot;sa&quot;
password=&quot;&quot;
url=&quot;jdbc:HypersonicSQL:./database/defaultdb&quot;
inactivity-timeout=&quot;30&quot;
/&gt;
</pre></div></li>
  
<li>
<p>In the example installation outlined above, Orion cannot locate <b>spy.properties</b> because of the classpath  that Orion uses. Use the -D option to tell Orion where the property file resides by running Orion using  the following command:</p>
  
<div class="source">
<pre>java -Dp6.home=c:\orion\orion\lib -jar orion.jar
</pre></div></li>
  
<li>
<p>Modify the realdriver line in the <b>spy.properties</b> file to reflect the wrapped database driver.  (This is the original value specified in connection-driver.) For example, if Hypersonic  (the default database) was the original connection-driver value, the realdriver value  is set to <b>org.hsql.jdbcDriver</b>.</p></li>
</ol>
<p>Installation is complete. When you run your application, a log file ( <b>spy.log</b> ) is generated in the orion-home directory of the Orion server. The log file contains a list of all of the database statements executed. You can change both the destination of <b>spy.log</b> and what it logs by editing the <b>spy.properties</b> file (see <a href="configandusage.html#settings">Common Property File Settings</a>).</p></div>
<div class="section">
<h2>Jakarta Tomcat<a name="Jakarta_Tomcat"></a></h2>
<p>The following instructions were tested with Jakarta Tomcat 3.x. Note that since you typically write or otherwise obtain your own Connection Pool when using Tomcat, these instructions will differ by application. To install P6Spy on Jakarta Tomcat, complete the following steps:</p>

<ol style="list-style-type: decimal">
  
<li>Extract the <b>p6spy-install.jar</b> file. The <b>p6spy-install.jar</b> file contains <b>p6spy.jar</b> and <b>spy.properties</b>.</li>
  
<li>Move the <b>p6spy.jar</b> and <b>spy.properties</b> files to the lib directory. An example of the path to your <tt>lib directory is</tt> C:\jakarta-tomcat-3.2.1\webapps\p6\WEB-INF\lib`.</li>
  
<li>
<p>Modify Tomcat to use P6SpyDriver. Tomcat applications obtain their JDBC connection in a variety of ways.  Most applications have the database driver name externalized as a configuration parameter. For example, in  your <b>web.xml</b> file (which resides in <tt>C:\jakarta-tomcat-3.2.1\webapps\p6\WEB-INF</tt>) you may have something  similar to the following:</p>
  
<div class="source">
<pre>&lt;init-param&gt;&lt;param-name&gt;databaseDriver&lt;/param-name&gt;&lt;param-value&gt;org.gjt.mm.mysql.Driver&lt;/param-value&gt;&lt;/init-param&gt;
</pre></div>
<p>In this above case, the databaseDriver parameter has a value of <b>org.gjt.mm.mysql.Driver</b>, which is the MySQL driver. Wherever this configuration information is stored, change the driver name (<b>org.gjt.mm.mysql.Driver</b>, in our example) to <b>com.p6spy.engine.spy.P6SpyDriver</b>, as in the following example:</p>
  
<div class="source">
<pre>&lt;init-param&gt;&lt;param-name&gt;databaseDriver&lt;/param-name&gt;&lt;param-value&gt;com.p6spy.engine.spy.P6SpyDriver&lt;/param-value&gt;&lt;/init-param&gt;
</pre></div></li>
  
<li>
<p>Enable Tomcat to locate <b>spy.properties</b>. While all of the JAR files in your lib directory are, by default,  included in Tomcat&#x2019;s classpath, the lib directory itself is not. This means Tomcat will not be able to find your  <b>spy.properties</b> file, which will result in an error. So, you must include <b>spy.properties</b> in the Tomcat  classpath. Use the TOMCAT_OPTS environment variable to specify the location of the <b>spy.properties</b> file.  An example of the edited TOMCAT_OPTS environment variable follows:</p>
  
<div class="source">
<pre>SET TOMCAT_OPTS=-Dp6.home=C:\jakarta-tomcat-3.2.1\webapps\p6\WEB-INF\lib
</pre></div></li>
  
<li>
<p>Modify the realdriver line in the <b>spy.properties</b> file to reflect the wrapped database driver. An example of a `modified realdriver line (using MySQL as the driver) follows:</p>
  
<div class="source">
<pre>realdriver = org.gjt.mm.mysql.Driver
</pre></div></li>
</ol>
<p>Installation is complete. When you run your application, a log file ( <b>spy.log</b> ) is generated in the directory from which you launched the application. The log file contains a list of all of the database statements executed. You can change both the destination of <b>spy.log</b> and what it logs by editing the <b>spy.properties</b> file (see <a href="configandusage.html#settings">Common Property File Settings</a>).</p></div>
<div class="section">
<h2>JOnAS EJB<a name="JOnAS_EJB"></a></h2>
<p>(Contributed by Fran&#xe7;ois Exertier, JOnAS Opensource EJB Server team)</p>
<p>The following instructions were tested with JOnAS 2.3.x. To install P6Spy on JOnAS EJB, complete the following steps:</p>

<ol style="list-style-type: decimal">
  
<li>Extract the <b>p6spy-install.jar</b> file. The <b>p6spy-install.jar</b> file contains <b>p6spy.jar</b> and <b>spy.properties</b>.</li>
  
<li>Put the <b>p6spy.jar</b> file in the classpath of the JOnAS EJB server. For example, if <b>p6spy.jar</b> is in the  <tt>/opt/Provider6</tt> directory, add <tt>/opt/Provider6/p6psy.jar</tt> to the XTRA_CLASSPATH environment variable or  directly edit the config_env script.</li>
  
<li>Move <b>spy.properties</b> to a directory which is part of your classpath. It is recommended that you move it  to the directory where your jndi.properties file resides.</li>
  
<li>
<p>Modify the <b>datasource.properties</b> file (where datasource is the name of the data source) by replacing the  database driver classname with the P6Psy database driver classname in the datasource.classname property.  For example, the Oracle1.properties file delivered with JOnAS should be updated by replacing  <b>oracle.jdbc.driver.OracleDriver</b> with <b>com.p6spy.engine.spy.P6SpyDriver</b>. An example follows:</p>
  
<div class="source">
<pre>datasource.name   jdbc_1
datasource.description  &quot;Standard jdbc driver for Oracle&quot;
datasource.url   jdbc:oracle:thin:scott/tiger@maltes:1521:ORA1
datasource.classname com.p6spy.engine.spy.P6SpyDriver
...
</pre></div></li>
</ol>
<p>Note: Database access configuration within JOnAS is described in a DataSource property file, such as Oracle1.properties. Refer to the JOnAS Bean Programmer&#x2019;s Guide for more details.</p>

<ol style="list-style-type: decimal">
  
<li>
<p>Modify the realdriver line in the <b>spy.properties</b> file to reflect the wrapped database driver. An  example of a modified realdriver line follows:</p>
  
<div class="source">
<pre>realdriver = oracle.jdbc.driver.OracleDriver
</pre></div></li>
</ol>
<p>Installation is complete. When you run your application, a log file ( <b>spy.log</b> ) is generated in the directory from which you launched the application. The log file contains a list of all of the database statements executed. You can change both the destination of <b>spy.log</b> and what it logs by editing the <b>spy.properties</b> file (see <a href="configandusage.html#settings">Common Property File Settings</a>).</p></div>
<div class="section">
<h2>BEA WebLogic<a name="BEA_WebLogic"></a></h2>
<p>The following sections contain specific information on installing P6Spy on <a href="#beaportal">BEA WebLogic Portal 4.0</a>, <a href="#wlserver6">BEA WebLogic Server 6.1</a>, and <a href="#wlserver5">BEA WebLogic 5.1</a>.</p>
<p>Note: IBM Cloudscape does not work with P6Spy and BEA WebLogic. However, Cloudscape does work with P6Spy when using the J2EE reference implementation server. The following suggestion was submitted by Adrian Fletcher:</p>
<p><i>&#x201c;I may be wrong but I suspect the problem with Cloudscape and WebLogic is that both drivers end up registered against the same URL. I seem to remember that the best trick for avoiding this is mangling the URL. If you instruct users to prepend &#x201d;p6spy:&#x201c; to their URL and then remove it in your wrapped file, it should work in more cases.&#x201d; You can do this with the useprefix option.</i></p>
<p>If anyone has an opportunity to validate this, please drop us a line with updated information.</p>
<div class="section">
<h3><a name="beaportal">BEA WebLogic Portal 4.0</a><a name="BEA_WebLogic_Portal_4.0"></a></h3>
<p>(Contributed by Philip Ogren, BEA) The following instructions were tested with WebLogic Server 6.1 Service Pack 2 with WebLogic Portal 4.0 Service Pack 1 running on Microsoft Windows using the following:</p>

<ul>
  
<li>WebLogic jDriver for Oracle</li>
  
<li>Oracle Thin driver for 8.1.7</li>
  
<li>WebLogic jDriver for Microsoft SQL Server</li>
  
<li>Sybase jConnect-5_2 driver</li>
</ul>
<p>The default Stockportal (Avitek) application is used in this example. To install P6Spy on BEA WebLogic Portal,  complete the following steps:</p>

<ol style="list-style-type: decimal">
  
<li>Extract the <b>p6spy-install.jar</b> file to a temporary directory. The <b>p6spy-install.jar</b> file contains the  files <b>p6spy.jar</b> and <b>spy.properties</b>.</li>
  
<li>Move <b>p6spy.jar</b> to <tt>bea-home\wlportal4.0\lib\ext</tt>, where bea-home is the directory in which BEA WebLogic is  installed.</li>
  
<li>Add <tt>;%P13N_DIR%\lib\ext\p6spy.jar</tt> to <tt>EXT_CLASSPATH</tt> in the <b>set-environment.bat</b> file. <b>set-environment.bat</b>  resides in <tt>bea-home\wlportal4.0\bin\win32</tt>. Do not include any trailing spaces after the new line.</li>
  
<li>Move <b>spy.properties</b> to bea-home\wlportal4.0\config\portalDomain or to the application&#x2019;s domain directory.</li>
  
<li>
<p>Modify the realdriver line in the <b>spy.properties</b> file to reflect your wrapped database driver. An example  of a modified realdriver line follows:</p>
  
<div class="source">
<pre>realdriver=weblogic.jdbc.oci.Driver
</pre></div></li>
  
<li>
<p>Add <tt>;%P13N_DIR%\config\portalDomain</tt> to the classpath in the <b>startPortal.bat</b> file. The path to <b>startPortal.bat</b>  is <tt>bea-home\wlportal4.0\config\portalDomain</tt>. Do not include any trailing spaces after the new line.</p></li>
  
<li>Modify WebLogic Portal to use the P6Spy driver. Either modify <b>config.xml</b> (which resides in  <tt>bea-home\wlportal4.0\config\portalDomain</tt>) directly or complete the following steps:</li>
</ol>

<ul>
  
<li>Start WebLogic Portal by running <b>startPortal.bat</b>.</li>
  
<li>Start the Administration Console tool by navigating to <tt>http://your-host:7501/console</tt>, where your-host is the machine on which BEA WebLogic is installed.</li>
  
<li>Navigate to the <i>your-domain</i> (where <i>your-domain</i> is the domain name specified during the BEA WebLogic install) <b>-&gt; Services -&gt; JDBC -&gt; Connection Pools</b> node and set the Driver Classname for each Connection Pool to <b>com.p6spy.engine.spy.P6SpyDriver</b>.</li>
</ul>

<ol style="list-style-type: decimal">
  
<li>If using RDBMS Security Realm, configure P6Spy to monitor your realms (in this example, commercePool,  dataSyncPool, and wlcsRealm) by completing the following steps:</li>
</ol>

<ul>
  
<li>Using the Administration Console, navigate to the <b>your-domain -&gt; Security -&gt; Realms</b> node.</li>
  
<li>Select the security realm.</li>
  
<li>Click the Database tab.</li>
  
<li>Set the Driver parameter to com.p6spy.engine.spy.P6SpyDriver.</li>
</ul>

<ol style="list-style-type: decimal">
  
<li>Using the Administration Console, shut down WebLogic Portal. Right-click on the <b>your-domain-&gt;Servers-&gt;your-server</b>  node and select <b>Stop this Server</b> from the pop-up menu.</li>
  
<li>Restart WebLogic Portal by running <b>startPortal.bat</b>.</li>
</ol>
<p>Installation is complete. When you run your application, a log file ( <b>spy.log</b> ) is generated in <tt>bea-home\wlportal4.0</tt>. The log file contains a list of all of the database statements executed. You can change both the destination of <b>spy.log</b> and what it logs by editing the <b>spy.properties</b> file (see <a href="configandusage.html#settings">Common Property File Settings</a>).</p></div>
<div class="section">
<h3><a name="wlserver6">BEA WebLogic Server 6.1</a><a name="BEA_WebLogic_Server_6.1"></a></h3>
<p>(Contributed by Philip Ogren, BEA)</p>
<p>The following instructions were tested with WebLogic Server 6.1 Service Pack 2 with WebLogic Portal 4.0 Service Pack 1 running on Microsoft Windows using the following:</p>

<ul>
  
<li>WebLogic jDriver for Oracle</li>
  
<li>Oracle Thin driver for 8.1.7</li>
  
<li>WebLogic jDriver for Microsoft SQL Server</li>
  
<li>Sybase jConnect-5_2 driver</li>
</ul>
<p>To install P6Spy on BEA WebLogic Server, complete the following steps:</p>

<ol style="list-style-type: decimal">
  
<li>Extract the <b>p6spy-install.jar</b> file to a temporary directory. The <b>p6spy-install.jar</b> file contains the  files <b>p6spy.jar</b> and <b>spy.properties</b>.</li>
  
<li>Move <b>p6spy.jar</b> to <tt>bea-home\wlserver6.1\lib\ext</tt>, where bea-home is the directory in which BEA  WebLogic is installed.</li>
  
<li>Move <b>spy.properties</b> to bea-home\wlserver6.1\config\your-domain, where your-domain is the domain name  specified during the BEA WebLogic install.</li>
  
<li>
<p>Modify the realdriver line in the <b>spy.properties</b> file to reflect your wrapped database driver. An  example of a modified realdriver line follows:</p>
  
<div class="source">
<pre>realdriver=weblogic.jdbc.oci.Driver
</pre></div></li>
  
<li>
<p>Add <tt>;.\lib\ext\**p6spy.jar**;.\config\your-domain</tt> to the classpath in the <b>startWebLogic.cmd</b> file.  <b>startWebLogic.cmd</b> resides in <tt>bea-home\wlserver6.1\config\your-domain</tt>. Do not include any trailing spaces  after the new line. This adds <b>p6spy.jar</b> and <b>spy.properties</b> to the classpath.</p></li>
  
<li>Modify WebLogic Server to use the P6Spy driver. Either modify <b>config.xml</b>  (which resides in <tt>bea-home\wlserver6.1\config\your-domain</tt>) directly or complete the following steps:</li>
</ol>

<ul>
  
<li>Start WebLogic Server by running <b>startWebLogic.cmd</b>.</li>
  
<li>Start the Administration Console tool by navigating to <tt>http://&lt;your-host&gt;:7501/console</tt>.</li>
  
<li>Navigate to the <b>your-domain -&gt; Services -&gt; JDBC -&gt; Connection Pools</b> node and set the Driver Classname  for each Connection Pool to <b>com.p6spy.engine.spy.P6SpyDriver</b>.</li>
</ul>

<ol style="list-style-type: decimal">
  
<li>If using RDBMS Security Realm, configure P6Spy to to monitor your realms (in this example, commercePool,  dataSyncPool, and wlcsRealm) by completing the following steps:</li>
</ol>

<ul>
  
<li>Using the Administration Console, navigate to the <b>your-domain -&gt; Security -&gt; Realms</b> node.</li>
  
<li>Select the security realm.</li>
  
<li>Click the Database tab.</li>
  
<li>Set the Driver parameter to <b>com.p6spy.engine.spy.P6SpyDriver</b>.</li>
</ul>

<ol style="list-style-type: decimal">
  
<li>Using the Administration Console, shut down WebLogic Server. Right-click on the  <b>your-domain -&gt; Servers -&gt; your-server</b> node and select <b>Stop this Server</b> from the pop-up menu.</li>
  
<li>Restart WebLogic Portal by running <b>startWebLogic.cmd</b>.</li>
</ol>
<p>Installation is complete. When you run your application, a log file ( <b>spy.log</b> ) is generated in <tt>bea-home\wlserver6.1</tt>. The log file contains a list of all of the database statements executed. You can change both the destination of <b>spy.log</b> and what it logs by editing the <b>spy.properties</b> file (see <a href="configandusage.html#settings">Common Property File Settings</a>).</p></div>
<div class="section">
<h3><a name="wlserver5">BEA WebLogic 5.1</a><a name="BEA_WebLogic_5.1"></a></h3>
<p>(Contributed by Richard Delbert)</p>
<p>The following instructions were tested with WebLogic 5.1. To install P6Spy on BEA WebLogic, complete the following steps:</p>

<ol style="list-style-type: decimal">
  
<li>Extract the <b>p6spy-install.jar</b> file. The <b>p6spy-install.jar</b> file contains <b>p6spy.jar</b> and <b>spy.properties</b>.</li>
  
<li>Edit <b>startWeblogic.sh</b>, by putting <b>p6spy.jar</b> in the JAVA_CLASSPATH.</li>
  
<li>Edit <b>startWeblogic.sh</b>, by putting <b>spy.properties</b> in the JAVA_CLASSPATH.</li>
  
<li>Edit <b>weblogic.properties</b> (Connection Pool), by replacing the JDBC class driver with <b>com.p6spy.engine.spy.P6SpyDriver</b>.</li>
  
<li>
<p>Modify the realdriver line in the <b>spy.properties</b> file to reflect your wrapped database driver. An example of  a modified realdriver line follows:</p>
  
<div class="source">
<pre>realdriver = oracle.jdbc.driver.OracleDriver
</pre></div></li>
</ol>
<p>Installation is complete. When you run your application, a log file ( <b>spy.log</b> ) is generated in the WebLogic home directory. The log file contains a list of all of the database statements executed. You can change both the destination of <b>spy.log</b> and what it logs by editing the <b>spy.properties</b> file (see <a href="configandusage.html#settings">Common Property File Settings</a>).</p></div></div>
<div class="section">
<h2>ATG Dynamo<a name="ATG_Dynamo"></a></h2>
<p>The following instructions were tested with ATG Dynamo 5.1. To install P6Spy on ATG Dynamo, complete the following steps:</p>

<ol style="list-style-type: decimal">
  
<li>Extract the <b>p6spy-install.jar</b> file into a directory (C:\p6spy, in our example). The  <b>p6spy-install.jar</b> contains <b>p6spy.jar</b> and <b>spy.properties</b>.</li>
  
<li>Start the ATG Dynamo application server and your database.</li>
  
<li>Modify the ATG Dynamo server to include <b>p6spy.jar</b> and <b>spy.properties</b> in its classpath by completing the  following steps:
  
<ol style="list-style-type: decimal">
    
<li>Run the Admin Tool by logging in to <tt>http://localhost:8830</tt>, assuming you are. (This URL is an example  which assumes you are running ATG Dynamo on your local machine). Note: The default user/pass is admin/admin.</li>
    
<li>Select <b>Configuration Manager -&gt; Default Configuration -&gt; System Paths</b>.</li>
    
<li>Enter the full path of the <b>p6spy.jar</b> file under <b>Extend Dynamo&#x2019;s Classpath</b>. An example of  the path is <tt>C:\p6spy\p6spy.jar</tt>.</li>
    
<li>Enter the full path of the <b>spy.properties</b> file under Extend Dynamo&#x2019;s Classpath. An example of the  path is <tt>C:\p6spy</tt>.</li>
    
<li>Click Append to Classpath.</li>
    
<li>Confirm the new classpath value is correct under <b>Extend Dynamo&#x2019;s Classpath</b>.</li>
    
<li>Restart ATG Dynamo by navigating to <tt>http://localhost:8830</tt> and clicking <b>Restart Dynamo</b>.</li>
  </ol></li>
  
<li>
<p>Modify the realdriver line in the <b>spy.properties</b> file to reflect the wrapped database driver. The  realdriver property is, by default, set to Oracle, as in:</p>
  
<div class="source">
<pre>realdriver = oracle.jdbc.driver.OracleDriver
</pre></div>
<p>Change this to reflect your database. An example of a modified realdriver line for ATG demo follows:</p>
  
<div class="source">
<pre>realdriver = solid.jdbc.SolidDriver
</pre></div></li>
  
<li>
<p>Modify ATG to use the P6Spy driver by completing the following steps:</p>
  
<ol style="list-style-type: decimal">
    
<li>Run the Admin Tool by logging in to <tt>http://localhost:8830</tt>.</li>
    
<li>Select <b>Configuration Manager -&gt; Default Configuration -&gt; Connection Pools -&gt; JTDataSource -&gt; JDBC 1.x/2.x driver -&gt; Custom JDBC Information</b>.</li>
    
<li>Enter the information exactly as you would for connecting to your database, except for the driver box. Set the driver box to <b>com.p6spy.engine.spy.P6SpyDriver</b>.</li>
  </ol>
<p>An example setup follows:</p>
  
<div class="source">
<pre>  URL: jdbc:solid://localhost:1313
  driver: com.p6spy.engine.spy.P6SpyDriver
  database:
  server: localhost:1313
  server name:
  user name: admin
  password: admin
  confirm password: admin
</pre></div>
  
<ol style="list-style-type: decimal">
    
<li>Click Try to Connect. Confirm that the ATG connection is successful.</li>
    
<li>Click Apply Changes, if the connection is successful.</li>
    
<li>Restart ATG Dynamo by navigating to to <tt>http://localhost:8830</tt> and clicking Restart Dynamo.</li>
  </ol></li>
</ol>
<p>Installation is complete. When you run your application, a log file ( <b>spy.log</b> ) is generated in the <tt>C:\ATG\Dynamo5.1\home</tt> directory. The log file contains a list of all of the database statements executed. You can change both the destination of <b>spy.log</b> and what it logs by editing the <b>spy.properties</b> file (see <a href="configandusage.html#settings">Common Property File Settings</a>).</p></div>
<div class="section">
<h2>Sun iPlanet<a name="Sun_iPlanet"></a></h2>
<p>(Contributed by Michael Sgroi)</p>
<p>The following instructions were tested with Sun iPlanet 6.0 Service Pack 3 and should work for any release of iPlanet 6.0. To install P6Spy on iPlanet, complete the following steps:</p>

<ol style="list-style-type: decimal">
  
<li>Extract the <b>p6spy-install.jar</b> file into a directory named spy-home, where spy-home is the name of the  P6Spy directory. The <b>p6spy-install.jar</b> file contains <b>p6spy.jar</b> and <b>spy.properties</b>.</li>
  
<li>Add <b>p6spy.jar</b> to your classpath by running the command line executable <b>kregedit</b>.  Under <b>Software\iPlanet -&gt; 6.0 -&gt; Java -&gt; ClassPath</b>, modify the entry adding spy-home to the end of the classpath.</li>
  
<li>
<p>Modify your application server to use the P6Spy database driver by running the command line executable  <b>jdbcsetup</b>. Add a new 3rd Party JDBC Configuration as shown in the following example:</p>
  
<div class="source">
<pre>Driver Identifier: spy
Driver Classname: com.p6spy.engine.spy.P6SpyDriver
Driver Classpath: spy-home\p6spy.jar
</pre></div></li>
  
<li>
<p>To tell P6Spy about the wrapped database driver, register your DataSource by running the following command line executable:</p>
  
<div class="source">
<pre>iasdeploy regdatasource -user iPlanet_admin_username -password iPlanet_admin_password -host localhost -port iPlanet_admin _port config_filename
</pre></div>
<p>where iPlanet_admin_username is your iPlanet admin username, iPlanet_admin_password is your iPlanet admin password, iPlanet_admin_port is the iPlanet admin port number, and config_filename is the full path to the file containing your DataSource configuration. An example follows:</p>
  
<div class="source">
<pre>&lt;ias-resource&gt;
&lt;resource&gt;
&lt;jndi-name&gt;jdbc/yourapp/ora-type4-spy&lt;/jndi-name&gt;
&lt;jdbc&gt;
&lt;driver-type&gt;spy&lt;/driver-type&gt;
&lt;database-url&gt;jdbc:oracle:thin:@localhost:1521:orcl&lt;/database-url&gt;
&lt;username&gt;user&lt;/username&gt;
&lt;password&gt;password&lt;/password&gt;
&lt;/jdbc&gt;
&lt;/resource&gt;
&lt;/ias-resource&gt;
</pre></div>
<p>(For more details on parameters passed to <b>iasdeploy</b> and the format of config_filename, refer to the iPlanet documentation.) Installation is complete. When you run your application, a <b>spy.log</b> file is generated. The log file contains a list of all of the database statements executed. You can change both the destination of <b>spy.log</b> and what it logs by editing the <b>spy.properties</b> file (see <a href="configandusage.html#settings">Common Property File Settings</a>).</p></li>
</ol></div>
<div class="section">
<h2>IBM WebSphere<a name="IBM_WebSphere"></a></h2>
<p>The following instructions were tested with IBM WebSphere 4.0.</p>
<p>Note: Before installing, make sure your JDBC driver is configured in your target application server as a DataSource.</p>
<p>To install P6Spy on IBM WebSphere, complete the following steps:</p>

<ol style="list-style-type: decimal">
  
<li>Extract the <b>p6spy-install.jar</b> file. The installation file contains <b>p6spy.jar</b> and <b>spy.properties</b>.</li>
  
<li>Run the WebSphere Administration tool by logging in to <tt>http://localhost/9090/admin</tt>.</li>
  
<li>Under the WebSphere Administration Domain, open the Resources tree.</li>
  
<li>Open the JDBC Drivers tree.</li>
  
<li>Open the JDBC Driver you want to replace. The list of DataSources defined for this driver displays.</li>
  
<li>Click on the name of the DataSource that you want to trace with P6Spy. The configuration page for that DataSource displays.</li>
  
<li>
<p>Before making any changes, make a note of the values for the following fields:</p>
  
<div class="source">
<pre>DatabaseName
Default User
Default Password
</pre></div></li>
  
<li>
<p>Click <b>Properties</b> to view the Driver Specific properties. Each of the items displayed in the table is a setting  that the driver needs in order to connect to the database. Make a note of the name and value of each item. In our  MySQL example, these properties are as follows:</p>
  
<div class="source">
<pre>port 3306
serverName myhost
</pre></div></li>
  
<li>
<p>Navigate to the previous page (the configuration page for the driver), and change the JNDI Name for the DataSource.  For example, if the DataSource JNDI name is <b>MySqlDS</b>, change it to <b>RealMySqlDS</b>.</p></li>
  
<li>Click <b>JDBC Drivers</b> (in the left panel), to open the list of Drivers.</li>
  
<li>Click <b>New</b> to open a configuration page for a new driver.</li>
  
<li>Accept the <b>User-defined JDBC Driver</b> selection.</li>
  
<li>Click <b>Next</b>.</li>
  
<li>Fill in the table with the following values:  Server Class Path = path_to_p6spy.jar  Name = P6SpyDriver  Description = P6Spy JDBC tracing driver  Implementation Classname = com.p6spy.engine.spy.P6ConnectionPoolDataSource</li>
  
<li>Click <b>OK</b>. The list of drivers, which contains your new driver specifications, displays.</li>
  
<li>Open the new JDBC Drivers tree, which contains P6SpyDriver, in the left panel.</li>
  
<li>Open the <b>Data Sources</b> folder.</li>
  
<li>Click <b>New</b> to create a new DataSource for P6SpyDriver.</li>
  
<li>Set this DataSource up like the original configuration for your target driver (the one that you earlier recorded  in your notes), except for two things: the DataSource name and the Driver Specific properties. Use something  different for the DataSource name, and do not set any Driver Specific properties.</li>
  
<li>Save the configuration.</li>
  
<li>
<p>Configure the <b>spy.properties</b> file. Assuming that your names match the ones used above, and that you are using  the MySQL driver from mysql.com, your DataSource related entries should look like the following examples:</p>
  
<div class="source">
<pre>realdatasource=RealMySqlDS
prealdatasourceclass=com.mysql.jdbc.jdbc2.optional.MysqlDataSource
realdatasourceproperties=port;3306,serverName;myhost
</pre></div>
<p>Note: The items in <b>realdatasourceproperties</b> are the items that you recorded from the Driver Specific properties in your original DataSource configuration.</p></li>
  
<li>
<p>Modify the realdriver line in the <b>spy.properties</b> file to reflect the wrapped database driver (<b>com.mysql.Driver</b>,  in our example). An example of a modified realdriver line follows:</p>
  
<div class="source">
<pre>realdriver=com.mysql.Driver
</pre></div></li>
  
<li>
<p>Move the <b>spy.properties</b> file to the WebSphere/AppServer/properties directory.</p></li>
  
<li>Restart WebSphere, by using either the FirstSteps control panel or the scripts in the WebSphere bin directory.</li>
</ol>
<p>Installation is complete. When you run your application, a <b>spy.log</b> file is generated. The log file contains a list of all of the database statements executed. You can change both the destination of <b>spy.log</b> and what it logs by editing the <b>spy.properties</b> file (see <a href="configandusage.html#settings">Common Property File Settings</a>).</p></div>
<div class="section">
<h2>Caucho Resin<a name="Caucho_Resin"></a></h2>
<p>(Contributed by Hadi Nahari, RadonSoft)</p>
<p>The following instructions were tested with Resin 2.1.x. Note that since you typically write or otherwise obtain your own Connection Pool when using Resin, these instructions will differ by application. To install P6Spy on Resin, complete the following steps:</p>

<ol style="list-style-type: decimal">
  
<li>Extract the <b>p6spy-install.jar</b> file. The <b>p6spy-install.jar</b> file contains <b>p6spy.jar</b> and <b>spy.properties</b>.</li>
  
<li>Move the <b>p6spy.jar</b> and <b>spy.properties</b> files to the lib directory. An example of the path to your lib  directory is <tt>C:\resin-2.1.6\webapps\your_app_name\WEB-INF\lib</tt>, where your_app_name is the name of your application.</li>
  
<li>
<p>Modify Resin to use P6SpyDriver. Resin applications obtain their JDBC connection in a variety of ways. Most  applications have the database driver name externalized as a configuration parameter. For example, in your  <b>web.xml</b> file (which may reside in <tt>C:\resin-2.1.6\webapps\your_app_name\WEB-INF</tt>) you may have something similar to the following:</p>
  
<div class="source">
<pre>&lt;init-param&gt;
&lt;param-name&gt;db.driver&lt;/param-name&gt;
&lt;!-- mysql (mm driver) --&gt;
&lt;param-value&gt;org.gjt.mm.mysql.Driver&lt;/param-value&gt;
&lt;/init-param&gt;
</pre></div>
<p>In the above case, the db.driver parameter has a value of <b>org.gjt.mm.mysql.Driver</b>, which is the MySQL driver. Wherever this configuration information is stored, change the driver name (<b>org.gjt.mm.mysql.Driver</b>, in our example) to <b>com.p6spy.engine.spy.P6SpyDriver</b>, as in the following example:</p>
  
<div class="source">
<pre>&lt;init-param&gt;
&lt;param-name&gt;db.driver&lt;/param-name&gt;
&lt;!-- mysql (mm driver) --&gt;
&lt;param-value&gt;com.p6spy.engine.spy.P6SpyDriver&lt;/param-value&gt;
&lt;/init-param&gt;
</pre></div></li>
  
<li>
<p>Modify the realdriver line in the <b>spy.properties</b> file to reflect the wrapped database driver. An example of a modified realdriver line (using MySQL as the driver) follows:</p>
  
<div class="source">
<pre>realdriver = **org.gjt.mm.mysql.Driver**
</pre></div></li>
  
<li>
<p>In your start-up script (for Unix), or startup command-line (for Windows), enable Resin to locate <b>spy.properties</b>.  While all of the JAR files in your lib directory are, by default, included in Resin&#x2019;s classpath, the lib directory  itself is not. This means Resin will not be able to find your <b>spy.properties</b> file, which will result in an error.  So, you must include <b>spy.properties</b> in the Resin classpath. Use Resin&#x2019;s command-line argument to specify the  location of the <b>spy.properties</b> file. An example of passing p6.home environment variable as a command-line  argument to Resin&#x2019;s httpd on Windows follows:</p>
  
<div class="source">
<pre>C:\resin-2.1.6\bin\httpd - -Dp6.home=C:\resin-2.1.6\webapps\your_app_name\WEB-INF\lib
</pre></div></li>
</ol>
<p>Installation is complete. When you run your application, a log file ( <b>spy.log</b> ) is generated in the directory from which you launched the application. The log file contains a list of all of the database statements executed. You can change both the destination of <b>spy.log</b> and what it logs by editing the <b>spy.properties</b> file (see <a href="configandusage.html#settings">Common Property File Settings</a>).</p></div>
<div class="section">
<h2><a name="unspec">Unspecified Application Server</a><a name="Unspecified_Application_Server"></a></h2>
<p>The following installation instructions are intended for use with application servers not listed above and applications that do not use application servers. To install P6Spy, complete the following steps:</p>

<ol style="list-style-type: decimal">
  
<li>Extract the <b>p6spy-install.jar</b> file. The <b>p6spy-install.jar</b> file contains <b>p6spy.jar</b> and <b>spy.properties</b>.</li>
  
<li>
<p>Put the <b>p6spy.jar</b> file in your classpath by copying the <b>p6spy.jar</b> file into your ext directory. If you are using an EJB server it probably has its own ext directory. If you are not using an EJB server, then use the JDK ext directory, which is JDK_HOME/jre/lib/ext, or add <b>p6spy.jar</b> to your classpath. Remember that if you are adding <b>p6spy.jar</b> to your classpath, you must reference the JAR filename directly. An example of the path in Microsoft Windows follows:</p>
  
<div class="source">
<pre>CLASSPATH=c:\p6spy\p6spy.jar
</pre></div>
<p>Note: If you are using an EJB server, adding the <b>p6spy.jar</b> file to your classpath may not work. Some EJB servers ignore the classpath, setting their own on startup.</p></li>
  
<li>Move <b>spy.properties</b> into a directory listed in your classpath. For example, if your classpath is C:\p6spy\p6spy.jar;c:\java, copy it to the java directory. Unlike JAR files, you do not directly reference your property file in the classpath.</li>
  
<li>Modify your application server or application to use the P6Spy database driver.</li>
  
<li>
<p>Modify the realdriver line in the <b>spy.properties</b> file to reflect the wrapped database driver. An example of a modified realdriver line follows:</p>
  
<div class="source">
<pre>realdriver = oracle.jdbc.driver.OracleDriver
</pre></div></li>
</ol>
<p>Installation is complete. When you run your application, a <b>spy.log</b> file is generated. The log file contains a list of all of the database statements executed. You can change both the destination of <b>spy.log</b> and what it logs by editing the <b>spy.properties</b> file (see <a href="configandusage.html#settings">Common Property File Settings</a>).</p></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                    2013
                      P6Spy.
            All Rights Reserved.      
                    
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
